# 🎮 MMORPG游戏AI助手 - 图形界面使用指南

## 📦 安装与启动

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 启动GUI
```bash
python 启动GUI.py
```

---

## 🧭 界面导航

启动后，你会看到一个 800x636 的固定尺寸窗口（含36px自定义标题栏），采用现代化的无边框设计：

- **自定义标题栏**：顶部包含窗口标题和控制按钮（最小化、关闭），支持拖拽移动窗口
- **左侧导航栏**：宽度100px，包含所有功能模块图标（首页、数据收集、训练、运行、配置、数据管理）
- **右侧内容区**：显示当前选中模块的详细内容，外边距16px
- **底部状态栏**：高度24px，显示当前操作状态和提示信息

点击左侧导航栏的任意图标即可切换到对应功能页面，页面切换带有平滑的淡入淡出动画效果（200ms）。

### 性能优化特性
- **延迟加载**：页面按需创建，首次访问时才初始化
- **异步初始化**：主窗口先显示基础框架，后台逐步加载各页面
- **状态更新节流**：最小更新间隔50ms，避免过于频繁的UI刷新

---

## 🏠 首页（状态仪表盘）

首页采用仪表盘风格布局，提供系统状态概览：

### 系统状态卡片（横跨整个宽度）
- **模型状态**：显示决策模型是否已加载（[OK] 已加载 / [X] 未加载）
- **GPU状态**：显示是否检测到可用GPU（支持TensorFlow和PyTorch，后台异步检测避免阻塞）
- **数据文件**：显示已收集的数据文件数量和样本总数
- **上次训练**：显示最近一次训练的时间和损失值

### 快捷操作按钮（水平排列）
四个快捷按钮，每个130x85px：
- **快速运行**：直接跳转到运行页面
- **开始录制**：跳转到数据收集页面
- **训练模型**：跳转到训练页面
- **数据管理**：跳转到数据管理页面

### 提示卡片
根据系统状态自动显示下一步操作建议：
- 无数据时提示收集训练数据
- 有数据但无模型时提示开始训练
- 无GPU时提示将使用CPU运行
- 系统就绪时提示可以启动AI

### 快捷键卡片
显示全局快捷键提示：T - 暂停/继续 | ESC - 停止 | Ctrl+S - 保存配置 | F1 - 帮助

---

## ⚙️ 首次配置（必须）

启动后，点击左侧导航栏的 **配置** 图标，进入配置页面。

### 配置页面分为4个标签页：

#### 1️⃣ 窗口设置（最重要！）

**窗口区域设置**
- **窗口X/Y**：游戏窗口在屏幕上的起始位置（像素）
- **宽度/高度**：游戏窗口的尺寸

**快捷选择窗口**
1. 点击「🎯 选择窗口」按钮
2. 在弹出的窗口选择对话框中：
   - 从窗口列表中选择你的游戏窗口（带缩略图预览）
   - 使用搜索框过滤窗口
   - 或使用「点击选择」模式：倒计时后点击目标窗口自动捕获
3. 确认选择后自动填充窗口位置

**窗口预览**
- 实时显示窗口区域在屏幕上的位置预览图

#### 2️⃣ 模型设置
- **决策模型路径**：决策模型文件路径
- **YOLO模型路径**：YOLO检测模型路径
- **置信度阈值**：检测置信度阈值（0.0-1.0）

#### 3️⃣ 训练设置
- **批次大小**：训练批次大小（1-256）
- **学习率**：学习率（0.0001-0.1）
- **训练轮次**：训练轮次数

#### 4️⃣ 运行设置
- **启用YOLO**：是否启用YOLO检测
- **显示调试**：是否显示调试信息
- **日志级别**：日志输出级别（DEBUG/INFO/WARNING/ERROR）

### 配置操作
- **保存**：保存当前配置（快捷键 Ctrl+S）
- **重置默认**：将所有配置重置为默认值
- **重置此分区**：仅重置当前标签页的配置

---

## 📊 使用流程

### 第一步：收集训练数据

1. 切换到 **🎥 数据收集** 页面
2. 选择训练模式：
   - **主线任务**：适合主线剧情任务
   - **自动战斗**：适合战斗场景
   - **通用模式**：通用场景
3. 点击 **开始** 按钮
4. 倒计时（4秒）结束后，切换到游戏窗口
5. 正常进行游戏操作，系统会自动记录：
   - 屏幕画面
   - 你的按键操作
   - 智能评估数据价值

**页面布局（左右两栏 60:40）**
- **左栏（60%）**：控制面板 + 状态监控
- **右栏（40%）**：智能录制面板 + 游戏画面预览
- **底部**：操作说明卡片（横跨整个宽度）

**控制面板**
- 训练模式下拉选择
- 开始/暂停/停止按钮
- 快捷键提示

**状态监控显示**
- 录制状态（录制中/已暂停/已停止/倒计时）
- 样本数量
- 文件编号
- 帧率
- 当前动作

**智能录制功能**
- 实时显示当前片段的价值评分（0-100）
- 价值评分进度条，颜色随等级变化
- 价值等级：高价值（≥70，绿色）、中价值（40-69，黄色）、低价值（<40，红色）
- 自动统计高/中/低价值片段数量和总计
- 可选择保存策略：
  - **保留全部**：保存所有录制数据
  - **仅保留高价值**：只保存高价值片段
  - **自动过滤低价值**：自动过滤低价值片段

**游戏画面预览**
- 实时显示游戏画面缩略图
- 保持16:9宽高比（宽高比1.778）
- 无内容时显示"等待录制开始..."占位提示

**控制快捷键**
- `T` - 暂停/继续录制
- `ESC` - 停止录制

💡 建议收集至少 **1000-2000** 个样本才能训练出较好的模型。

---

### 第二步：训练AI模型

1. 切换到 **🤖 模型训练** 页面
2. 选择训练模式（与数据收集时一致）
3. 调整训练参数：
   - **训练轮次**：1-1000轮，建议10-50轮
   - **批次大小**：1-256，默认32
   - **学习率**：0.0001-0.1，默认0.001
4. 点击 **开始训练** 按钮
5. 观察训练进度

**页面布局（上下两区 60:40，使用分割器）**
- **上区（60%）**：左栏训练设置卡片 + 右栏训练进度卡片
- **下区（40%）**：训练日志卡片
- **底部**：提示卡片

**训练设置卡片**
- 训练模式选择（主线任务/自动战斗）
- 参数设置网格（轮次、批次、学习率）
- 开始训练/停止训练按钮

**训练进度卡片**
- 进度条显示完成百分比
- 当前轮次 / 总轮次
- 当前损失值（4位小数）
- 训练状态（未开始/准备中/训练中/已暂停/已停止/已完成）
- 预计剩余时间（MM:SS格式）
- 损失曲线实时更新（需安装 pyqtgraph，否则显示安装提示）

**训练日志卡片**
- 显示详细的训练日志信息，带时间戳
- 日志级别颜色区分（信息/警告/错误/成功）
- 支持清除日志按钮

**控制快捷键**
- `ESC` - 停止训练（会保存当前进度）

💡 训练过程中可以随时停止，模型会自动保存检查点。

---

### 第三步：运行AI机器人

1. 切换到 **🤖 机器人运行** 页面
2. 选择运行模式：
   - **基础模式**：仅使用训练的决策模型
   - **增强模式**：启用YOLO检测、状态识别、决策引擎等高级功能
3. 选择任务模式（主线任务/自动战斗，与训练时一致）
4. 点击 **启动** 按钮
5. 倒计时（4秒）结束后，切换到游戏窗口
6. AI会自动控制角色进行游戏

**页面布局（左右两栏 50:50）**
- **左栏（50%）**：运行模式卡片 + 增强模块状态卡片
- **右栏（50%）**：运行状态卡片 + 运行日志卡片
- **顶部**：脱困/性能警告提示条（默认隐藏）

**运行模式卡片**
- 运行模式选择（基础模式/增强模式）
- 任务模式选择（主线任务/自动战斗）
- 启动/暂停/停止按钮
- 快捷键提示

**运行状态卡片**
- **运行状态**：运行中/已暂停/已停止/倒计时/准备中
- **当前动作**：显示AI正在执行的动作
- **动作来源**：模型预测/规则决策/混合决策/降级模式
- **游戏状态**：战斗（红色）/对话（蓝色）/移动（绿色）/空闲/死亡/加载/未知
- **帧率**：显示运行帧率（颜色指示：绿色≥25、黄色≥15、红色<15）
- **运动量**：显示角色运动量（用于检测卡住）

**增强模块状态卡片**（增强模式下显示）
- **YOLO检测器**：目标检测状态（[OK] 已加载 / [X] 不可用）
- **状态识别器**：游戏状态识别
- **决策引擎**：混合决策引擎
- **脱困模块**：自动脱困功能
- **自动调参**：性能自适应（启用/禁用）
- **性能模式**：正常/低性能

**运行日志卡片**
- 显示运行日志，带时间戳和颜色区分
- 自动滚动到最新日志

**脱困提示**
- 检测到角色可能卡住时，会显示黄色提示条
- 自动执行脱困动作
- 3秒后自动隐藏

**性能警告**
- 帧率过低时，会显示红色警告
- 自动降低检测频率
- 5秒后自动隐藏

**控制快捷键**
- `T` - 暂停/继续运行
- `ESC` - 停止运行

---

## 📁 数据管理

切换到 **📁 数据管理** 页面可以：
- 查看已收集的数据文件列表
- 查看每个文件的样本数量
- 删除不需要的数据文件
- 查看数据统计信息

---

## ⌨️ 全局快捷键

无论在哪个页面，都可以使用以下快捷键：

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `T` | 暂停/继续 | 暂停或继续当前运行的任务 |
| `ESC` | 停止 | 停止当前运行的任务 |
| `Ctrl+S` | 保存配置 | 在配置页面保存当前配置 |
| `F1` | 帮助 | 显示快捷键帮助对话框 |

💡 提示：快捷键在任何页面都可使用

---

## 💡 使用技巧

### 数据收集技巧
- 尽量在不同场景下收集数据（战斗、移动、对话等）
- 保持操作的多样性，避免重复单一动作
- 使用智能录制的「自动过滤低价值」选项提高数据质量
- 关注价值评分，高价值片段对训练更有帮助

### 训练技巧
- 首次训练建议使用较少轮数（10-20轮）快速验证
- 观察损失曲线，如果持续下降说明训练正常
- 如果损失不再下降，可以停止训练
- 训练中途停止会自动保存检查点，可以继续训练

### 运行技巧
- 首次运行建议使用基础模式测试
- 如果AI表现不佳，可以收集更多数据重新训练
- 增强模式需要更多计算资源，低配置电脑建议使用基础模式
- 观察帧率，如果低于15FPS建议降低配置

### 性能优化
- 降低模型输入尺寸可以提高运行速度
- 启用「自动降级」可以在性能不足时自动优化
- 关闭不需要的增强模块可以减少资源占用
- 使用GPU可以显著提升训练和推理速度

---

## ❓ 常见问题

**Q: 为什么AI的动作很奇怪？**
A: 可能是训练数据不足或质量不高，建议收集更多高价值数据重新训练。

**Q: 运行时帧率很低怎么办？**
A: 
1. 降低模型输入尺寸
2. 启用「自动降级」功能
3. 关闭部分增强模块
4. 使用基础模式运行

**Q: 如何切换不同的游戏？**
A: 在配置页面重新设置游戏窗口区域，使用「选择窗口」功能快速配置，然后保存配置。

**Q: 训练中途停止了怎么办？**
A: 模型会自动保存检查点，可以继续训练或直接使用当前模型。

**Q: 数据文件保存在哪里？**
A: 默认保存在项目根目录的 `数据/` 文件夹中。

**Q: 窗口选择对话框中看不到游戏窗口？**
A: 
1. 确保游戏已经启动
2. 点击「刷新」按钮更新窗口列表
3. 使用搜索框过滤窗口
4. 尝试使用「点击选择」模式

**Q: 智能录制的价值评分是如何计算的？**
A: 系统会根据画面变化、操作频率、动作多样性等因素综合评估数据价值。

**Q: 增强模式和基础模式有什么区别？**
A: 
- **基础模式**：仅使用训练的决策模型进行预测
- **增强模式**：额外启用YOLO目标检测、游戏状态识别、混合决策引擎、自动脱困等高级功能

---

## 📞 获取帮助

- 查看日志文件：`日志/错误日志_YYYYMMDD.log`
- 按 `F1` 查看快捷键帮助
- 查看配置文件：`配置/设置.py`
- 查看项目说明：`README.md`

---

## 🔧 技术信息

- **界面框架**：PySide6 (Qt for Python)
- **窗口尺寸**：800x636（含36px标题栏，内容区800x600）
- **窗口样式**：无边框窗口 + 自定义标题栏
- **导航栏宽度**：100px
- **内容区外边距**：16px
- **卡片间距**：12px
- **状态栏高度**：24px
- **页面切换动画**：200ms 淡入淡出（OutCubic缓动）
- **状态更新频率**：最小间隔50ms（节流）
- **页面加载方式**：延迟加载 + 异步初始化

---

**祝你使用愉快！🎉**
