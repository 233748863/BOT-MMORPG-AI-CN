# -*- coding: utf-8 -*-
"""
é¦–é¡µç»„ä»¶ (çŠ¶æ€ä»ªè¡¨ç›˜)

æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€æ¦‚è§ˆã€å¿«æ·æ“ä½œæŒ‰é’®å’Œä½¿ç”¨æç¤ºã€‚
é‡‡ç”¨ä»ªè¡¨ç›˜é£æ ¼å¸ƒå±€ï¼š
- é¡¶éƒ¨ï¼šç³»ç»ŸçŠ¶æ€å¡ç‰‡ï¼ˆæ¨ªè·¨æ•´ä¸ªå®½åº¦ï¼‰
- ä¸­éƒ¨ï¼šå¿«æ·æ“ä½œæŒ‰é’®ï¼ˆæ°´å¹³æ’åˆ—ï¼‰
- åº•éƒ¨ï¼šæç¤ºå¡ç‰‡ + å¿«æ·é”®å¡ç‰‡

ç¬¦åˆè®¾è®¡è§„èŒƒ:
- Requirements 6.1: ä»ªè¡¨ç›˜é£æ ¼å¸ƒå±€
- Requirements 6.2: ç³»ç»ŸçŠ¶æ€å¡ç‰‡ä½äºé¡¶éƒ¨ï¼Œæ¨ªè·¨æ•´ä¸ªå®½åº¦
- Requirements 6.3: å¿«æ·æ“ä½œæŒ‰é’®ä»¥2x2ç½‘æ ¼å½¢å¼æ’åˆ—åœ¨ä¸­éƒ¨
- Requirements 6.4: æ¯ä¸ªå¿«æ·æŒ‰é’®åŒ…å«å›¾æ ‡ã€æ ‡é¢˜å’Œç®€çŸ­æè¿°
- Requirements 6.5: æç¤ºä¿¡æ¯ä½äºé¡µé¢åº•éƒ¨
"""

import os
from pathlib import Path
from datetime import datetime
from typing import Optional, Dict, Any

from PySide6.QtWidgets import (
    QWidget, QVBoxLayout, QHBoxLayout, QLabel, 
    QPushButton, QFrame, QGridLayout, QSizePolicy
)
from PySide6.QtCore import Signal, Qt, QTimer
from PySide6.QtGui import QFont

from ç•Œé¢.æ ·å¼.ä¸»é¢˜ import é¢œè‰², è·å–çŠ¶æ€é¢œè‰²
from ç•Œé¢.æ ·å¼.å¸ƒå±€å¸¸é‡ import å¸ƒå±€å¸¸é‡
from ç•Œé¢.ç»„ä»¶.é€šç”¨ç»„ä»¶ import Card


class çŠ¶æ€å¡ç‰‡(Card):
    """
    ç³»ç»ŸçŠ¶æ€å¡ç‰‡ç»„ä»¶
    
    æ˜¾ç¤ºæ¨¡å‹çŠ¶æ€ã€GPUçŠ¶æ€ã€æ•°æ®æ–‡ä»¶å’Œä¸Šæ¬¡è®­ç»ƒä¿¡æ¯ã€‚
    æ¨ªè·¨æ•´ä¸ªå®½åº¦ (Requirements 6.2)
    """
    
    def __init__(self, parent=None):
        super().__init__("ç³»ç»ŸçŠ¶æ€", "ğŸ“Š", parent)
        self._åˆå§‹åŒ–çŠ¶æ€æ˜¾ç¤º()
    
    def _åˆå§‹åŒ–çŠ¶æ€æ˜¾ç¤º(self) -> None:
        """åˆå§‹åŒ–çŠ¶æ€æ˜¾ç¤ºåŒºåŸŸ"""
        # çŠ¶æ€ç½‘æ ¼
        çŠ¶æ€ç½‘æ ¼ = QGridLayout()
        çŠ¶æ€ç½‘æ ¼.setSpacing(å¸ƒå±€å¸¸é‡.å¡ç‰‡é—´è·)
        çŠ¶æ€ç½‘æ ¼.setContentsMargins(0, 4, 0, 0)
        
        # æ¨¡å‹çŠ¶æ€
        self._æ¨¡å‹çŠ¶æ€æ ‡ç­¾ = self._åˆ›å»ºçŠ¶æ€é¡¹("æ¨¡å‹çŠ¶æ€:", "æ£€æµ‹ä¸­...", çŠ¶æ€ç½‘æ ¼, 0, 0)
        
        # GPUçŠ¶æ€
        self._GPUçŠ¶æ€æ ‡ç­¾ = self._åˆ›å»ºçŠ¶æ€é¡¹("GPU:", "æ£€æµ‹ä¸­...", çŠ¶æ€ç½‘æ ¼, 0, 1)
        
        # æ•°æ®æ–‡ä»¶
        self._æ•°æ®æ–‡ä»¶æ ‡ç­¾ = self._åˆ›å»ºçŠ¶æ€é¡¹("æ•°æ®æ–‡ä»¶:", "æ£€æµ‹ä¸­...", çŠ¶æ€ç½‘æ ¼, 1, 0)
        
        # ä¸Šæ¬¡è®­ç»ƒ
        self._ä¸Šæ¬¡è®­ç»ƒæ ‡ç­¾ = self._åˆ›å»ºçŠ¶æ€é¡¹("ä¸Šæ¬¡è®­ç»ƒ:", "æ£€æµ‹ä¸­...", çŠ¶æ€ç½‘æ ¼, 1, 1)
        
        self.æ·»åŠ å¸ƒå±€(çŠ¶æ€ç½‘æ ¼)
    
    def _åˆ›å»ºçŠ¶æ€é¡¹(self, æ ‡é¢˜: str, åˆå§‹å€¼: str, ç½‘æ ¼: QGridLayout, è¡Œ: int, åˆ—: int) -> QLabel:
        """åˆ›å»ºçŠ¶æ€é¡¹"""
        å®¹å™¨ = QWidget()
        å®¹å™¨å¸ƒå±€ = QHBoxLayout(å®¹å™¨)
        å®¹å™¨å¸ƒå±€.setContentsMargins(0, 0, 0, 0)
        å®¹å™¨å¸ƒå±€.setSpacing(8)
        
        æ ‡é¢˜æ ‡ç­¾ = QLabel(æ ‡é¢˜)
        æ ‡é¢˜æ ‡ç­¾.setStyleSheet(f"color: {é¢œè‰².æ¬¡è¦æ–‡å­—}; font-size: {å¸ƒå±€å¸¸é‡.æ­£æ–‡å­—å·}px;")
        å®¹å™¨å¸ƒå±€.addWidget(æ ‡é¢˜æ ‡ç­¾)
        
        å€¼æ ‡ç­¾ = QLabel(åˆå§‹å€¼)
        å€¼æ ‡ç­¾.setStyleSheet(f"color: {é¢œè‰².æ–‡å­—}; font-size: {å¸ƒå±€å¸¸é‡.æ­£æ–‡å­—å·}px; font-weight: 500;")
        å®¹å™¨å¸ƒå±€.addWidget(å€¼æ ‡ç­¾)
        å®¹å™¨å¸ƒå±€.addStretch()
        
        ç½‘æ ¼.addWidget(å®¹å™¨, è¡Œ, åˆ—)
        return å€¼æ ‡ç­¾
    
    def æ›´æ–°æ¨¡å‹çŠ¶æ€(self, å·²åŠ è½½: bool, è·¯å¾„: str = "") -> None:
        """æ›´æ–°æ¨¡å‹çŠ¶æ€æ˜¾ç¤º"""
        if å·²åŠ è½½:
            self._æ¨¡å‹çŠ¶æ€æ ‡ç­¾.setText("âœ… å·²åŠ è½½")
            self._æ¨¡å‹çŠ¶æ€æ ‡ç­¾.setStyleSheet(f"color: {é¢œè‰².æˆåŠŸ}; font-size: {å¸ƒå±€å¸¸é‡.æ­£æ–‡å­—å·}px; font-weight: 500;")
        else:
            self._æ¨¡å‹çŠ¶æ€æ ‡ç­¾.setText("âŒ æœªåŠ è½½")
            self._æ¨¡å‹çŠ¶æ€æ ‡ç­¾.setStyleSheet(f"color: {é¢œè‰².é”™è¯¯}; font-size: {å¸ƒå±€å¸¸é‡.æ­£æ–‡å­—å·}px; font-weight: 500;")
    
    def æ›´æ–°GPUçŠ¶æ€(self, å¯ç”¨: bool, è®¾å¤‡å: str = "") -> None:
        """æ›´æ–°GPUçŠ¶æ€æ˜¾ç¤º"""
        if å¯ç”¨:
            æ˜¾ç¤ºæ–‡æœ¬ = f"âœ… å¯ç”¨"
            if è®¾å¤‡å:
                æ˜¾ç¤ºæ–‡æœ¬ = f"âœ… {è®¾å¤‡å}"
            self._GPUçŠ¶æ€æ ‡ç­¾.setText(æ˜¾ç¤ºæ–‡æœ¬)
            self._GPUçŠ¶æ€æ ‡ç­¾.setStyleSheet(f"color: {é¢œè‰².æˆåŠŸ}; font-size: {å¸ƒå±€å¸¸é‡.æ­£æ–‡å­—å·}px; font-weight: 500;")
        else:
            self._GPUçŠ¶æ€æ ‡ç­¾.setText("âš ï¸ ä»…CPU")
            self._GPUçŠ¶æ€æ ‡ç­¾.setStyleSheet(f"color: {é¢œè‰².è­¦å‘Š}; font-size: {å¸ƒå±€å¸¸é‡.æ­£æ–‡å­—å·}px; font-weight: 500;")
    
    def æ›´æ–°æ•°æ®æ–‡ä»¶çŠ¶æ€(self, æ–‡ä»¶æ•°: int, æ ·æœ¬æ•°: int) -> None:
        """æ›´æ–°æ•°æ®æ–‡ä»¶çŠ¶æ€æ˜¾ç¤º"""
        if æ–‡ä»¶æ•° > 0:
            self._æ•°æ®æ–‡ä»¶æ ‡ç­¾.setText(f"ğŸ“ {æ–‡ä»¶æ•°}ä¸ªæ–‡ä»¶ ({æ ·æœ¬æ•°}æ ·æœ¬)")
            self._æ•°æ®æ–‡ä»¶æ ‡ç­¾.setStyleSheet(f"color: {é¢œè‰².æˆåŠŸ}; font-size: {å¸ƒå±€å¸¸é‡.æ­£æ–‡å­—å·}px; font-weight: 500;")
        else:
            self._æ•°æ®æ–‡ä»¶æ ‡ç­¾.setText("ğŸ“ æ— æ•°æ®")
            self._æ•°æ®æ–‡ä»¶æ ‡ç­¾.setStyleSheet(f"color: {é¢œè‰².è­¦å‘Š}; font-size: {å¸ƒå±€å¸¸é‡.æ­£æ–‡å­—å·}px; font-weight: 500;")
    
    def æ›´æ–°è®­ç»ƒçŠ¶æ€(self, ä¸Šæ¬¡è®­ç»ƒæ—¶é—´: Optional[datetime], æŸå¤±å€¼: Optional[float] = None) -> None:
        """æ›´æ–°ä¸Šæ¬¡è®­ç»ƒçŠ¶æ€æ˜¾ç¤º"""
        if ä¸Šæ¬¡è®­ç»ƒæ—¶é—´:
            æ—¶é—´å­—ç¬¦ä¸² = ä¸Šæ¬¡è®­ç»ƒæ—¶é—´.strftime("%Y-%m-%d %H:%M")
            if æŸå¤±å€¼ is not None:
                self._ä¸Šæ¬¡è®­ç»ƒæ ‡ç­¾.setText(f"{æ—¶é—´å­—ç¬¦ä¸²} (æŸå¤±: {æŸå¤±å€¼:.4f})")
            else:
                self._ä¸Šæ¬¡è®­ç»ƒæ ‡ç­¾.setText(æ—¶é—´å­—ç¬¦ä¸²)
            self._ä¸Šæ¬¡è®­ç»ƒæ ‡ç­¾.setStyleSheet(f"color: {é¢œè‰².æ–‡å­—}; font-size: {å¸ƒå±€å¸¸é‡.æ­£æ–‡å­—å·}px; font-weight: 500;")
        else:
            self._ä¸Šæ¬¡è®­ç»ƒæ ‡ç­¾.setText("æš‚æ— è®°å½•")
            self._ä¸Šæ¬¡è®­ç»ƒæ ‡ç­¾.setStyleSheet(f"color: {é¢œè‰².æ¬¡è¦æ–‡å­—}; font-size: {å¸ƒå±€å¸¸é‡.æ­£æ–‡å­—å·}px; font-weight: 500;")


class å¿«æ·æŒ‰é’®(QPushButton):
    """
    å¿«æ·æ“ä½œæŒ‰é’®ç»„ä»¶
    
    æ¯ä¸ªæŒ‰é’®åŒ…å«å›¾æ ‡ã€æ ‡é¢˜å’Œæè¿° (Requirements 6.4)
    å°ºå¯¸: 120-140pxå®½ï¼Œ80-90pxé«˜
    """
    
    def __init__(self, å›¾æ ‡: str, æ ‡é¢˜: str, æè¿°: str, parent=None):
        super().__init__(parent)
        self._å›¾æ ‡ = å›¾æ ‡
        self._æ ‡é¢˜ = æ ‡é¢˜
        self._æè¿° = æè¿°
        self._åˆå§‹åŒ–æ ·å¼()
    
    def _åˆå§‹åŒ–æ ·å¼(self) -> None:
        """åˆå§‹åŒ–æŒ‰é’®æ ·å¼"""
        # è®¾ç½®å°ºå¯¸åœ¨è§„å®šèŒƒå›´å†… (120-140pxå®½ï¼Œ80-90pxé«˜)
        self.setFixedSize(130, 85)
        self.setCursor(Qt.PointingHandCursor)
        
        # è®¾ç½®æŒ‰é’®æ–‡æœ¬ï¼šå›¾æ ‡ + æ ‡é¢˜ + æè¿°
        self.setText(f"{self._å›¾æ ‡}\n{self._æ ‡é¢˜}\n{self._æè¿°}")
        self.setToolTip(self._æè¿°)
        
        self.setStyleSheet(f"""
            QPushButton {{
                background-color: {é¢œè‰².å¡ç‰‡èƒŒæ™¯};
                border: {å¸ƒå±€å¸¸é‡.å¡ç‰‡è¾¹æ¡†å®½åº¦}px solid {é¢œè‰².è¾¹æ¡†};
                border-radius: {å¸ƒå±€å¸¸é‡.å¡ç‰‡åœ†è§’}px;
                font-size: {å¸ƒå±€å¸¸é‡.æ­£æ–‡å­—å·}px;
                font-weight: 500;
                color: {é¢œè‰².æ ‡é¢˜};
                text-align: center;
                padding: 8px;
            }}
            QPushButton:hover {{
                background-color: {é¢œè‰².é€‰ä¸­èƒŒæ™¯};
                border-color: {é¢œè‰².ä¸»è‰²};
            }}
            QPushButton:pressed {{
                background-color: {é¢œè‰².æ‚¬åœèƒŒæ™¯};
            }}
        """)
    
    @property
    def å›¾æ ‡(self) -> str:
        """è·å–æŒ‰é’®å›¾æ ‡"""
        return self._å›¾æ ‡
    
    @property
    def æ ‡é¢˜(self) -> str:
        """è·å–æŒ‰é’®æ ‡é¢˜"""
        return self._æ ‡é¢˜
    
    @property
    def æè¿°(self) -> str:
        """è·å–æŒ‰é’®æè¿°"""
        return self._æè¿°
    
    def è·å–å®½åº¦(self) -> int:
        """è·å–æŒ‰é’®å®½åº¦"""
        return self.width()
    
    def è·å–é«˜åº¦(self) -> int:
        """è·å–æŒ‰é’®é«˜åº¦"""
        return self.height()


class æç¤ºå¡ç‰‡(Card):
    """
    ä½¿ç”¨æç¤ºå¡ç‰‡ç»„ä»¶
    
    ä½äºé¡µé¢åº•éƒ¨ (Requirements 6.5)
    """
    
    def __init__(self, parent=None):
        super().__init__("", "", parent)
        self._åˆå§‹åŒ–æç¤ºæ˜¾ç¤º()
    
    def _åˆå§‹åŒ–æç¤ºæ˜¾ç¤º(self) -> None:
        """åˆå§‹åŒ–æç¤ºæ˜¾ç¤º"""
        # ä½¿ç”¨ç‰¹æ®ŠèƒŒæ™¯è‰²
        self.setStyleSheet(f"""
            QFrame#Card {{
                background-color: {é¢œè‰².é€‰ä¸­èƒŒæ™¯};
                border-radius: {å¸ƒå±€å¸¸é‡.å¡ç‰‡åœ†è§’}px;
                border: {å¸ƒå±€å¸¸é‡.å¡ç‰‡è¾¹æ¡†å®½åº¦}px solid {é¢œè‰².è¾¹æ¡†};
            }}
        """)
        
        æç¤ºå®¹å™¨ = QWidget()
        æç¤ºå¸ƒå±€ = QHBoxLayout(æç¤ºå®¹å™¨)
        æç¤ºå¸ƒå±€.setContentsMargins(0, 0, 0, 0)
        æç¤ºå¸ƒå±€.setSpacing(8)
        
        å›¾æ ‡ = QLabel("ğŸ’¡")
        å›¾æ ‡.setStyleSheet(f"font-size: {å¸ƒå±€å¸¸é‡.é¡µé¢æ ‡é¢˜å­—å·}px;")
        æç¤ºå¸ƒå±€.addWidget(å›¾æ ‡)
        
        self._æç¤ºæ–‡æœ¬ = QLabel("æç¤º: é¦–æ¬¡ä½¿ç”¨è¯·å…ˆæ”¶é›†è®­ç»ƒæ•°æ®")
        self._æç¤ºæ–‡æœ¬.setStyleSheet(f"color: {é¢œè‰².ä¸»è‰²}; font-size: {å¸ƒå±€å¸¸é‡.æ­£æ–‡å­—å·}px;")
        self._æç¤ºæ–‡æœ¬.setWordWrap(True)
        æç¤ºå¸ƒå±€.addWidget(self._æç¤ºæ–‡æœ¬, 1)
        
        self.æ·»åŠ å†…å®¹(æç¤ºå®¹å™¨)
    
    def è®¾ç½®æç¤º(self, æ–‡æœ¬: str) -> None:
        """è®¾ç½®æç¤ºæ–‡æœ¬"""
        self._æç¤ºæ–‡æœ¬.setText(f"æç¤º: {æ–‡æœ¬}")


class å¿«æ·é”®å¡ç‰‡(Card):
    """
    å¿«æ·é”®æç¤ºå¡ç‰‡ç»„ä»¶
    
    ä½äºé¡µé¢åº•éƒ¨ (Requirements 6.5)
    """
    
    def __init__(self, parent=None):
        super().__init__("å¿«æ·é”®", "âŒ¨ï¸", parent)
        self._åˆå§‹åŒ–å¿«æ·é”®æ˜¾ç¤º()
    
    def _åˆå§‹åŒ–å¿«æ·é”®æ˜¾ç¤º(self) -> None:
        """åˆå§‹åŒ–å¿«æ·é”®æ˜¾ç¤º"""
        å¿«æ·é”®å†…å®¹ = QLabel(
            "T - æš‚åœ/ç»§ç»­  |  ESC - åœæ­¢  |  Ctrl+S - ä¿å­˜é…ç½®  |  F1 - å¸®åŠ©"
        )
        å¿«æ·é”®å†…å®¹.setStyleSheet(f"color: {é¢œè‰².æ¬¡è¦æ–‡å­—}; font-size: {å¸ƒå±€å¸¸é‡.æ¬¡è¦æ–‡å­—å­—å·}px;")
        self.æ·»åŠ å†…å®¹(å¿«æ·é”®å†…å®¹)


class é¦–é¡µ(QWidget):
    """
    é¦–é¡µç»„ä»¶ (çŠ¶æ€ä»ªè¡¨ç›˜)
    
    é‡‡ç”¨ä»ªè¡¨ç›˜é£æ ¼å¸ƒå±€ (Requirements 6.1):
    - é¡¶éƒ¨ï¼šç³»ç»ŸçŠ¶æ€å¡ç‰‡ï¼ˆæ¨ªè·¨æ•´ä¸ªå®½åº¦ï¼‰(Requirements 6.2)
    - ä¸­éƒ¨ï¼šå¿«æ·æ“ä½œæŒ‰é’®ï¼ˆæ°´å¹³æ’åˆ—ï¼‰(Requirements 6.3)
    - åº•éƒ¨ï¼šæç¤ºå¡ç‰‡ + å¿«æ·é”®å¡ç‰‡ (Requirements 6.5)
    """
    
    # ä¿¡å·å®šä¹‰
    å¿«é€Ÿè¿è¡Œç‚¹å‡» = Signal()
    å¼€å§‹å½•åˆ¶ç‚¹å‡» = Signal()
    è®­ç»ƒæ¨¡å‹ç‚¹å‡» = Signal()
    æ•°æ®ç®¡ç†ç‚¹å‡» = Signal()
    
    def __init__(self, parent=None):
        """åˆå§‹åŒ–é¦–é¡µ"""
        super().__init__(parent)
        self._åˆå§‹åŒ–ç•Œé¢()
        
        # å»¶è¿Ÿæ£€æµ‹ç³»ç»ŸçŠ¶æ€
        QTimer.singleShot(100, self._æ£€æµ‹ç³»ç»ŸçŠ¶æ€)
    
    def _åˆå§‹åŒ–ç•Œé¢(self) -> None:
        """
        åˆå§‹åŒ–ç•Œé¢å¸ƒå±€
        
        ä»ªè¡¨ç›˜é£æ ¼å¸ƒå±€:
        - é¡¶éƒ¨ï¼šé¡µé¢æ ‡é¢˜ + ç³»ç»ŸçŠ¶æ€å¡ç‰‡
        - ä¸­éƒ¨ï¼šå¿«æ·æ“ä½œæŒ‰é’®
        - åº•éƒ¨ï¼šæç¤ºå¡ç‰‡ + å¿«æ·é”®å¡ç‰‡
        """
        ä¸»å¸ƒå±€ = QVBoxLayout(self)
        ä¸»å¸ƒå±€.setContentsMargins(
            å¸ƒå±€å¸¸é‡.å†…å®¹åŒºå¤–è¾¹è·,
            å¸ƒå±€å¸¸é‡.å†…å®¹åŒºå¤–è¾¹è·,
            å¸ƒå±€å¸¸é‡.å†…å®¹åŒºå¤–è¾¹è·,
            å¸ƒå±€å¸¸é‡.å†…å®¹åŒºå¤–è¾¹è·
        )
        ä¸»å¸ƒå±€.setSpacing(å¸ƒå±€å¸¸é‡.å¡ç‰‡é—´è·)
        
        # ==================== é¡¶éƒ¨ï¼šé¡µé¢æ ‡é¢˜ ====================
        æ ‡é¢˜ = QLabel("ğŸ® MMORPGæ¸¸æˆAIåŠ©æ‰‹")
        æ ‡é¢˜.setStyleSheet(f"""
            font-size: {å¸ƒå±€å¸¸é‡.é¡µé¢æ ‡é¢˜å­—å·}px;
            font-weight: bold;
            color: {é¢œè‰².æ ‡é¢˜};
        """)
        ä¸»å¸ƒå±€.addWidget(æ ‡é¢˜)
        
        # ==================== é¡¶éƒ¨ï¼šç³»ç»ŸçŠ¶æ€å¡ç‰‡ï¼ˆæ¨ªè·¨æ•´ä¸ªå®½åº¦ï¼‰====================
        self._çŠ¶æ€å¡ç‰‡ = çŠ¶æ€å¡ç‰‡()
        ä¸»å¸ƒå±€.addWidget(self._çŠ¶æ€å¡ç‰‡)
        
        # ==================== ä¸­éƒ¨ï¼šå¿«æ·æ“ä½œåŒºåŸŸ ====================
        å¿«æ·æ“ä½œæ ‡é¢˜ = QLabel("å¿«æ·æ“ä½œ")
        å¿«æ·æ“ä½œæ ‡é¢˜.setStyleSheet(f"""
            font-size: {å¸ƒå±€å¸¸é‡.å¡ç‰‡æ ‡é¢˜å­—å·}px;
            font-weight: 500;
            color: {é¢œè‰².æ ‡é¢˜};
            margin-top: 4px;
        """)
        ä¸»å¸ƒå±€.addWidget(å¿«æ·æ“ä½œæ ‡é¢˜)
        
        # å¿«æ·æŒ‰é’®å®¹å™¨ï¼ˆæ°´å¹³æ’åˆ—ï¼‰
        æŒ‰é’®å®¹å™¨ = QWidget()
        æŒ‰é’®å¸ƒå±€ = QHBoxLayout(æŒ‰é’®å®¹å™¨)
        æŒ‰é’®å¸ƒå±€.setContentsMargins(0, 0, 0, 0)
        æŒ‰é’®å¸ƒå±€.setSpacing(å¸ƒå±€å¸¸é‡.å¡ç‰‡é—´è·)
        
        # åˆ›å»º4ä¸ªå¿«æ·æŒ‰é’® (Requirements 6.4: æ¯ä¸ªæŒ‰é’®åŒ…å«å›¾æ ‡ã€æ ‡é¢˜å’Œæè¿°)
        self._å¿«é€Ÿè¿è¡ŒæŒ‰é’® = å¿«æ·æŒ‰é’®("â–¶ï¸", "å¿«é€Ÿè¿è¡Œ", "å¯åŠ¨AI")
        self._å¿«é€Ÿè¿è¡ŒæŒ‰é’®.clicked.connect(self.å¿«é€Ÿè¿è¡Œç‚¹å‡».emit)
        æŒ‰é’®å¸ƒå±€.addWidget(self._å¿«é€Ÿè¿è¡ŒæŒ‰é’®)
        
        self._å¼€å§‹å½•åˆ¶æŒ‰é’® = å¿«æ·æŒ‰é’®("ğŸ¥", "å¼€å§‹å½•åˆ¶", "æ”¶é›†æ•°æ®")
        self._å¼€å§‹å½•åˆ¶æŒ‰é’®.clicked.connect(self.å¼€å§‹å½•åˆ¶ç‚¹å‡».emit)
        æŒ‰é’®å¸ƒå±€.addWidget(self._å¼€å§‹å½•åˆ¶æŒ‰é’®)
        
        self._è®­ç»ƒæ¨¡å‹æŒ‰é’® = å¿«æ·æŒ‰é’®("ğŸ§ ", "è®­ç»ƒæ¨¡å‹", "è®­ç»ƒAI")
        self._è®­ç»ƒæ¨¡å‹æŒ‰é’®.clicked.connect(self.è®­ç»ƒæ¨¡å‹ç‚¹å‡».emit)
        æŒ‰é’®å¸ƒå±€.addWidget(self._è®­ç»ƒæ¨¡å‹æŒ‰é’®)
        
        self._æ•°æ®ç®¡ç†æŒ‰é’® = å¿«æ·æŒ‰é’®("ğŸ“", "æ•°æ®ç®¡ç†", "ç®¡ç†æ•°æ®")
        self._æ•°æ®ç®¡ç†æŒ‰é’®.clicked.connect(self.æ•°æ®ç®¡ç†ç‚¹å‡».emit)
        æŒ‰é’®å¸ƒå±€.addWidget(self._æ•°æ®ç®¡ç†æŒ‰é’®)
        
        æŒ‰é’®å¸ƒå±€.addStretch()
        ä¸»å¸ƒå±€.addWidget(æŒ‰é’®å®¹å™¨)
        
        # ==================== åº•éƒ¨ï¼šæç¤ºå¡ç‰‡ + å¿«æ·é”®å¡ç‰‡ ====================
        # ä½¿ç”¨æç¤ºå¡ç‰‡
        self._æç¤ºå¡ç‰‡ = æç¤ºå¡ç‰‡()
        ä¸»å¸ƒå±€.addWidget(self._æç¤ºå¡ç‰‡)
        
        # å¿«æ·é”®å¡ç‰‡
        self._å¿«æ·é”®å¡ç‰‡ = å¿«æ·é”®å¡ç‰‡()
        ä¸»å¸ƒå±€.addWidget(self._å¿«æ·é”®å¡ç‰‡)
        
        # æ·»åŠ å¼¹æ€§ç©ºé—´
        ä¸»å¸ƒå±€.addStretch()
    
    def _æ£€æµ‹ç³»ç»ŸçŠ¶æ€(self) -> None:
        """æ£€æµ‹å¹¶æ›´æ–°ç³»ç»ŸçŠ¶æ€"""
        çŠ¶æ€ = æ£€æµ‹ç³»ç»ŸçŠ¶æ€()
        
        # æ›´æ–°æ¨¡å‹çŠ¶æ€
        self._çŠ¶æ€å¡ç‰‡.æ›´æ–°æ¨¡å‹çŠ¶æ€(çŠ¶æ€["æ¨¡å‹å·²åŠ è½½"], çŠ¶æ€.get("æ¨¡å‹è·¯å¾„", ""))
        
        # æ›´æ–°GPUçŠ¶æ€
        self._çŠ¶æ€å¡ç‰‡.æ›´æ–°GPUçŠ¶æ€(çŠ¶æ€["GPUå¯ç”¨"], çŠ¶æ€.get("GPUè®¾å¤‡å", ""))
        
        # æ›´æ–°æ•°æ®æ–‡ä»¶çŠ¶æ€
        self._çŠ¶æ€å¡ç‰‡.æ›´æ–°æ•°æ®æ–‡ä»¶çŠ¶æ€(çŠ¶æ€["æ•°æ®æ–‡ä»¶æ•°"], çŠ¶æ€["æ ·æœ¬æ€»æ•°"])
        
        # æ›´æ–°è®­ç»ƒçŠ¶æ€
        self._çŠ¶æ€å¡ç‰‡.æ›´æ–°è®­ç»ƒçŠ¶æ€(çŠ¶æ€.get("ä¸Šæ¬¡è®­ç»ƒæ—¶é—´"), çŠ¶æ€.get("ä¸Šæ¬¡æŸå¤±å€¼"))
        
        # æ›´æ–°æç¤º
        self._æ›´æ–°æç¤º(çŠ¶æ€)
    
    def _æ›´æ–°æç¤º(self, çŠ¶æ€: Dict[str, Any]) -> None:
        """æ ¹æ®ç³»ç»ŸçŠ¶æ€æ›´æ–°æç¤º"""
        if çŠ¶æ€["æ•°æ®æ–‡ä»¶æ•°"] == 0:
            self._æç¤ºå¡ç‰‡.è®¾ç½®æç¤º("é¦–æ¬¡ä½¿ç”¨è¯·å…ˆæ”¶é›†è®­ç»ƒæ•°æ®")
        elif not çŠ¶æ€["æ¨¡å‹å·²åŠ è½½"]:
            self._æç¤ºå¡ç‰‡.è®¾ç½®æç¤º("å·²æœ‰è®­ç»ƒæ•°æ®ï¼Œå¯ä»¥å¼€å§‹è®­ç»ƒæ¨¡å‹äº†")
        elif not çŠ¶æ€["GPUå¯ç”¨"]:
            self._æç¤ºå¡ç‰‡.è®¾ç½®æç¤º("æœªæ£€æµ‹åˆ°GPUï¼Œå°†ä½¿ç”¨CPUè¿è¡Œï¼ˆé€Ÿåº¦è¾ƒæ…¢ï¼‰")
        else:
            self._æç¤ºå¡ç‰‡.è®¾ç½®æç¤º("ç³»ç»Ÿå°±ç»ªï¼Œå¯ä»¥å¯åŠ¨AIæœºå™¨äººäº†")
    
    def åˆ·æ–°çŠ¶æ€(self) -> None:
        """æ‰‹åŠ¨åˆ·æ–°ç³»ç»ŸçŠ¶æ€"""
        self._æ£€æµ‹ç³»ç»ŸçŠ¶æ€()
    
    def è·å–çŠ¶æ€å¡ç‰‡(self) -> çŠ¶æ€å¡ç‰‡:
        """è·å–çŠ¶æ€å¡ç‰‡ç»„ä»¶"""
        return self._çŠ¶æ€å¡ç‰‡
    
    def è·å–å¿«æ·æŒ‰é’®åˆ—è¡¨(self) -> list:
        """è·å–æ‰€æœ‰å¿«æ·æŒ‰é’®åˆ—è¡¨"""
        return [
            self._å¿«é€Ÿè¿è¡ŒæŒ‰é’®,
            self._å¼€å§‹å½•åˆ¶æŒ‰é’®,
            self._è®­ç»ƒæ¨¡å‹æŒ‰é’®,
            self._æ•°æ®ç®¡ç†æŒ‰é’®
        ]



def æ£€æµ‹ç³»ç»ŸçŠ¶æ€() -> Dict[str, Any]:
    """
    æ£€æµ‹ç³»ç»ŸçŠ¶æ€
    
    è¿”å›:
        åŒ…å«ç³»ç»ŸçŠ¶æ€ä¿¡æ¯çš„å­—å…¸
    """
    çŠ¶æ€ = {
        "æ¨¡å‹å·²åŠ è½½": False,
        "æ¨¡å‹è·¯å¾„": "",
        "GPUå¯ç”¨": False,
        "GPUè®¾å¤‡å": "",
        "æ•°æ®æ–‡ä»¶æ•°": 0,
        "æ ·æœ¬æ€»æ•°": 0,
        "ä¸Šæ¬¡è®­ç»ƒæ—¶é—´": None,
        "ä¸Šæ¬¡æŸå¤±å€¼": None,
    }
    
    # æ£€æµ‹æ¨¡å‹æ–‡ä»¶
    çŠ¶æ€["æ¨¡å‹å·²åŠ è½½"], çŠ¶æ€["æ¨¡å‹è·¯å¾„"] = _æ£€æµ‹æ¨¡å‹æ–‡ä»¶()
    
    # æ£€æµ‹GPU
    çŠ¶æ€["GPUå¯ç”¨"], çŠ¶æ€["GPUè®¾å¤‡å"] = _æ£€æµ‹GPU()
    
    # ç»Ÿè®¡æ•°æ®æ–‡ä»¶
    çŠ¶æ€["æ•°æ®æ–‡ä»¶æ•°"], çŠ¶æ€["æ ·æœ¬æ€»æ•°"] = _ç»Ÿè®¡æ•°æ®æ–‡ä»¶()
    
    # æ£€æµ‹ä¸Šæ¬¡è®­ç»ƒä¿¡æ¯
    çŠ¶æ€["ä¸Šæ¬¡è®­ç»ƒæ—¶é—´"], çŠ¶æ€["ä¸Šæ¬¡æŸå¤±å€¼"] = _æ£€æµ‹è®­ç»ƒè®°å½•()
    
    return çŠ¶æ€


def _æ£€æµ‹æ¨¡å‹æ–‡ä»¶() -> tuple:
    """
    æ£€æµ‹æ¨¡å‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    
    è¿”å›:
        (æ˜¯å¦å­˜åœ¨, æ¨¡å‹è·¯å¾„)
    """
    try:
        from é…ç½®.è®¾ç½® import æ¨¡å‹ä¿å­˜è·¯å¾„, é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„
        
        # æ£€æŸ¥è®­ç»ƒåçš„æ¨¡å‹
        æ¨¡å‹ç›®å½• = Path(æ¨¡å‹ä¿å­˜è·¯å¾„)
        if æ¨¡å‹ç›®å½•.exists():
            # æ£€æŸ¥æ˜¯å¦æœ‰æ¨¡å‹æ–‡ä»¶
            æ¨¡å‹æ–‡ä»¶ = list(æ¨¡å‹ç›®å½•.glob("*.index")) + list(æ¨¡å‹ç›®å½•.glob("*.h5")) + list(æ¨¡å‹ç›®å½•.glob("*.pt"))
            if æ¨¡å‹æ–‡ä»¶:
                return True, str(æ¨¡å‹ç›®å½•)
        
        # æ£€æŸ¥é¢„è®­ç»ƒæ¨¡å‹
        é¢„è®­ç»ƒç›®å½• = Path(é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„).parent
        if é¢„è®­ç»ƒç›®å½•.exists():
            ç´¢å¼•æ–‡ä»¶ = Path(f"{é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„}.index")
            if ç´¢å¼•æ–‡ä»¶.exists():
                return True, str(é¢„è®­ç»ƒç›®å½•)
        
        return False, ""
    except Exception:
        return False, ""


def _æ£€æµ‹GPU() -> tuple:
    """
    æ£€æµ‹GPUæ˜¯å¦å¯ç”¨
    
    è¿”å›:
        (æ˜¯å¦å¯ç”¨, è®¾å¤‡åç§°)
    """
    try:
        import tensorflow as tf
        gpus = tf.config.list_physical_devices('GPU')
        if gpus:
            # è·å–ç¬¬ä¸€ä¸ªGPUçš„åç§°
            è®¾å¤‡å = gpus[0].name.split('/')[-1] if gpus else ""
            return True, è®¾å¤‡å
        return False, ""
    except Exception:
        pass
    
    # å°è¯•PyTorch
    try:
        import torch
        if torch.cuda.is_available():
            è®¾å¤‡å = torch.cuda.get_device_name(0)
            return True, è®¾å¤‡å
        return False, ""
    except Exception:
        pass
    
    return False, ""


def _ç»Ÿè®¡æ•°æ®æ–‡ä»¶() -> tuple:
    """
    ç»Ÿè®¡æ•°æ®æ–‡ä»¶æ•°é‡å’Œæ ·æœ¬æ•°
    
    è¿”å›:
        (æ–‡ä»¶æ•°, æ ·æœ¬æ€»æ•°)
    """
    try:
        from é…ç½®.è®¾ç½® import æ•°æ®ä¿å­˜è·¯å¾„, æ¯æ–‡ä»¶æ ·æœ¬æ•°
        import numpy as np
        
        æ•°æ®ç›®å½• = Path(æ•°æ®ä¿å­˜è·¯å¾„)
        if not æ•°æ®ç›®å½•.exists():
            return 0, 0
        
        # æŸ¥æ‰¾æ‰€æœ‰npzæ–‡ä»¶
        æ•°æ®æ–‡ä»¶åˆ—è¡¨ = list(æ•°æ®ç›®å½•.glob("*.npz"))
        æ–‡ä»¶æ•° = len(æ•°æ®æ–‡ä»¶åˆ—è¡¨)
        
        if æ–‡ä»¶æ•° == 0:
            return 0, 0
        
        # ç»Ÿè®¡æ ·æœ¬æ•°
        æ ·æœ¬æ€»æ•° = 0
        for æ–‡ä»¶è·¯å¾„ in æ•°æ®æ–‡ä»¶åˆ—è¡¨:
            try:
                æ•°æ® = np.load(str(æ–‡ä»¶è·¯å¾„), allow_pickle=True)
                if 'images' in æ•°æ®:
                    æ ·æœ¬æ€»æ•° += len(æ•°æ®['images'])
                elif 'frames' in æ•°æ®:
                    æ ·æœ¬æ€»æ•° += len(æ•°æ®['frames'])
                else:
                    # ä¼°ç®—æ ·æœ¬æ•°
                    æ ·æœ¬æ€»æ•° += æ¯æ–‡ä»¶æ ·æœ¬æ•°
            except Exception:
                æ ·æœ¬æ€»æ•° += æ¯æ–‡ä»¶æ ·æœ¬æ•°
        
        return æ–‡ä»¶æ•°, æ ·æœ¬æ€»æ•°
    except Exception:
        return 0, 0


def _æ£€æµ‹è®­ç»ƒè®°å½•() -> tuple:
    """
    æ£€æµ‹ä¸Šæ¬¡è®­ç»ƒè®°å½•
    
    è¿”å›:
        (ä¸Šæ¬¡è®­ç»ƒæ—¶é—´, ä¸Šæ¬¡æŸå¤±å€¼)
    """
    try:
        from é…ç½®.è®¾ç½® import æ¨¡å‹ä¿å­˜è·¯å¾„
        
        æ¨¡å‹ç›®å½• = Path(æ¨¡å‹ä¿å­˜è·¯å¾„)
        if not æ¨¡å‹ç›®å½•.exists():
            return None, None
        
        # æŸ¥æ‰¾æœ€æ–°çš„æ¨¡å‹æ–‡ä»¶
        æ¨¡å‹æ–‡ä»¶åˆ—è¡¨ = list(æ¨¡å‹ç›®å½•.glob("*.index")) + list(æ¨¡å‹ç›®å½•.glob("*.h5")) + list(æ¨¡å‹ç›®å½•.glob("*.pt"))
        
        if not æ¨¡å‹æ–‡ä»¶åˆ—è¡¨:
            return None, None
        
        # è·å–æœ€æ–°æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´
        æœ€æ–°æ–‡ä»¶ = max(æ¨¡å‹æ–‡ä»¶åˆ—è¡¨, key=lambda f: f.stat().st_mtime)
        ä¿®æ”¹æ—¶é—´ = datetime.fromtimestamp(æœ€æ–°æ–‡ä»¶.stat().st_mtime)
        
        # å°è¯•è¯»å–è®­ç»ƒæ—¥å¿—è·å–æŸå¤±å€¼
        æ—¥å¿—æ–‡ä»¶ = æ¨¡å‹ç›®å½• / "training_log.txt"
        æŸå¤±å€¼ = None
        if æ—¥å¿—æ–‡ä»¶.exists():
            try:
                with open(æ—¥å¿—æ–‡ä»¶, 'r', encoding='utf-8') as f:
                    è¡Œåˆ—è¡¨ = f.readlines()
                    if è¡Œåˆ—è¡¨:
                        æœ€åä¸€è¡Œ = è¡Œåˆ—è¡¨[-1]
                        # å°è¯•è§£ææŸå¤±å€¼
                        if "loss" in æœ€åä¸€è¡Œ.lower():
                            import re
                            åŒ¹é… = re.search(r'loss[:\s]+([0-9.]+)', æœ€åä¸€è¡Œ.lower())
                            if åŒ¹é…:
                                æŸå¤±å€¼ = float(åŒ¹é….group(1))
            except Exception:
                pass
        
        return ä¿®æ”¹æ—¶é—´, æŸå¤±å€¼
    except Exception:
        return None, None
