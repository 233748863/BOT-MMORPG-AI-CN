"""
增强模块配置设置
定义YOLO检测器、状态识别器、决策引擎的配置项
"""

from enum import Enum

# ==================== 实体类型枚举 ====================
class 实体类型枚举(Enum):
    """游戏中可识别的实体类型"""
    怪物 = "monster"
    NPC = "npc"
    玩家 = "player"
    物品 = "item"
    技能特效 = "skill_effect"
    未知 = "unknown"


# ==================== 游戏状态枚举 ====================
class 游戏状态枚举(Enum):
    """游戏状态枚举"""
    战斗 = "combat"
    对话 = "dialogue"
    菜单 = "menu"
    移动 = "moving"
    拾取 = "looting"
    采集 = "gathering"
    死亡 = "dead"
    加载 = "loading"
    空闲 = "idle"
    未知 = "unknown"


# ==================== YOLO检测器设置 ====================
YOLO配置 = {
    "模型路径": "模型/yolo/game_detector.pt",
    "置信度阈值": 0.5,
    "NMS阈值": 0.4,
    "输入尺寸": (640, 640),
    "启用": True,
    "检测间隔": 3,
}

# 实体类型映射 (YOLO类别ID -> 实体类型)
实体类型映射 = {
    0: 实体类型枚举.怪物,
    1: 实体类型枚举.NPC,
    2: 实体类型枚举.玩家,
    3: 实体类型枚举.物品,
    4: 实体类型枚举.技能特效,
}


# ==================== 状态识别器设置 ====================
状态识别配置 = {
    "历史长度": 10,
    "置信度累积系数": 0.1,
    "UI检测启用": True,
    "启用": True,
}

# UI元素模板路径
UI模板路径 = {
    "对话框": "资源/ui/dialogue_box.png",
    "菜单": "资源/ui/menu.png",
    "血条": "资源/ui/health_bar.png",
    "死亡界面": "资源/ui/death_screen.png",
    "加载界面": "资源/ui/loading.png",
}

# 状态判定阈值
状态判定阈值 = {
    "战斗_敌人距离": 200,
    "战斗_敌人数量": 1,
    "拾取_物品距离": 100,
}


# ==================== 决策引擎设置 ====================
class 决策策略枚举(Enum):
    """决策策略类型"""
    规则优先 = "rule_first"
    模型优先 = "model_first"
    混合加权 = "weighted_mix"


决策引擎配置 = {
    "策略": 决策策略枚举.混合加权,
    "规则权重": 0.6,
    "模型权重": 0.40,
    "启用日志": True,
    "日志长度": 100,
    "启用": True,
}

# 状态-动作权重映射
状态动作权重 = {
    游戏状态枚举.战斗: {
        "移动": 1.5,
        "技能": 2.5,
        "特殊": 2.0,
        "鼠标": 2.0,
        "组合": 1.5,
    },
    游戏状态枚举.对话: {
        "移动": 0.1,
        "技能": 0.0,
        "特殊": 0.5,
        "鼠标": 2.5,
        "组合": 0.0,
    },
    游戏状态枚举.菜单: {
        "移动": 0.0,
        "技能": 0.0,
        "特殊": 0.3,
        "鼠标": 3.0,
        "组合": 0.0,
    },
    游戏状态枚举.移动: {
        "移动": 3.0,
        "技能": 0.2,
        "特殊": 0.5,
        "鼠标": 1.0,
        "组合": 0.1,
    },
    游戏状态枚举.拾取: {
        "移动": 1.0,
        "技能": 0.0,
        "特殊": 1.0,
        "鼠标": 2.0,
        "组合": 0.0,
    },
    游戏状态枚举.采集: {
        "移动": 0.1,
        "技能": 0.0,
        "特殊": 0.3,
        "鼠标": 1.5,
        "组合": 0.0,
    },
    游戏状态枚举.死亡: {
        "移动": 0.0,
        "技能": 0.0,
        "特殊": 0.5,
        "鼠标": 2.0,
        "组合": 0.0,
    },
    游戏状态枚举.加载: {
        "移动": 0.0,
        "技能": 0.0,
        "特殊": 0.0,
        "鼠标": 0.0,
        "组合": 0.0,
    },
    游戏状态枚举.空闲: {
        "移动": 1.0,
        "技能": 0.5,
        "特殊": 1.0,
        "鼠标": 1.5,
        "组合": 0.5,
    },
    游戏状态枚举.未知: {
        "移动": 1.0,
        "技能": 0.5,
        "特殊": 0.5,
        "鼠标": 1.0,
        "组合": 0.5,
    },
}

# 动作冷却时间 (秒)
动作冷却时间 = {
    9: 1.0,
    10: 1.5,
    11: 2.0,
    12: 2.5,
    13: 3.0,
    14: 3.0,
    15: 1.0,
    16: 1.0,
    17: 2.0,
    18: 2.0,
    19: 0.5,
    20: 1.0,
}

# 紧急规则配置
紧急规则配置 = {
    "低血量阈值": 0.3,
    "被围攻阈值": 3,
    "紧急动作": 19,
}


# ==================== 模块启用配置 ====================
模块启用配置 = {
    "YOLO检测器": True,
    "状态识别器": True,
    "决策引擎": True,
}

# ==================== 性能配置 ====================
性能配置 = {
    "低性能模式检测间隔": 5,
    "帧率阈值": 15,
    "自动降级": True,
}


# ==================== 智能缓存配置 ====================
# 检测结果缓存优化配置
# 需求: 2.1, 2.2, 2.3, 3.1, 3.2, 3.3, 3.4
缓存配置 = {
    "启用": True,  # 是否启用智能缓存
    "全局相似度阈值": 0.95,  # 使用缓存的相似度阈值 (0.0-1.0)
    "过期时间": 0.5,  # 缓存过期时间（秒）
    "启用时间过期": True,  # 是否启用基于时间的过期
    "比较方法": "histogram",  # 帧比较方法: "histogram", "ssim", "mse", "hash"
    "预热帧数": 1,  # 预热帧数
    "配置文件路径": "配置/cache_config.json",  # 缓存配置文件路径
    "优先区域": [
        # 优先区域配置示例
        # 当这些区域发生显著变化时，即使全局相似度高也会触发新检测
        {
            "名称": "屏幕中心",
            "区域": [0.3, 0.3, 0.4, 0.4],  # 相对坐标 (x, y, w, h)，范围 0.0-1.0
            "阈值": 0.9  # 该区域的相似度阈值（比全局阈值更严格）
        }
    ]
}


# ==================== 状态检测配置 ====================
# 血量/蓝量检测配置
# 需求: 1.1, 1.4, 2.2, 3.1, 3.2
状态检测配置 = {
    "启用": True,  # 是否启用状态检测
    "配置目录": "配置/状态检测",  # 配置文件保存目录
    "默认配置": "default",  # 默认配置名称
    
    # 血条配置
    "血条": {
        "区域": None,  # 血条区域 (x, y, width, height)，None 表示未配置
        "颜色": {
            # 默认红色血条颜色范围 (HSV)
            "填充色": {
                "H_min": 0, "H_max": 10,  # 红色色调
                "S_min": 100, "S_max": 255,
                "V_min": 100, "V_max": 255
            }
        },
        "使用渐变": False,  # 是否使用渐变颜色配置
        "渐变颜色": {
            # 红色到黄色到绿色渐变（常见血条）
            "渐变色": [
                {"H_min": 0, "H_max": 10, "S_min": 100, "S_max": 255, "V_min": 100, "V_max": 255},  # 红色
                {"H_min": 10, "H_max": 25, "S_min": 100, "S_max": 255, "V_min": 100, "V_max": 255},  # 橙色
                {"H_min": 25, "H_max": 35, "S_min": 100, "S_max": 255, "V_min": 100, "V_max": 255},  # 黄色
                {"H_min": 35, "H_max": 85, "S_min": 100, "S_max": 255, "V_min": 100, "V_max": 255},  # 绿色
            ]
        },
        "平滑窗口": 5,  # 平滑窗口大小（帧数）
        "方向": "horizontal",  # 填充方向
    },
    
    # 蓝条配置
    "蓝条": {
        "区域": None,  # 蓝条区域 (x, y, width, height)，None 表示未配置
        "颜色": {
            # 默认蓝色蓝条颜色范围 (HSV)
            "填充色": {
                "H_min": 100, "H_max": 130,  # 蓝色色调
                "S_min": 100, "S_max": 255,
                "V_min": 100, "V_max": 255
            }
        },
        "平滑窗口": 5,  # 平滑窗口大小（帧数）
        "方向": "horizontal",  # 填充方向
    },
    
    # 错误处理配置
    "错误处理": {
        "失败超时": 5.0,  # 连续失败超时时间（秒），超时后返回满血/满蓝
        "最大连续失败": 10,  # 最大连续失败次数
    },
    
    # 预设颜色配置
    "预设颜色": {
        "红色血条": {
            "填充色": {"H_min": 0, "H_max": 10, "S_min": 100, "S_max": 255, "V_min": 100, "V_max": 255}
        },
        "绿色血条": {
            "填充色": {"H_min": 35, "H_max": 85, "S_min": 100, "S_max": 255, "V_min": 100, "V_max": 255}
        },
        "蓝色蓝条": {
            "填充色": {"H_min": 100, "H_max": 130, "S_min": 100, "S_max": 255, "V_min": 100, "V_max": 255}
        },
        "紫色蓝条": {
            "填充色": {"H_min": 130, "H_max": 160, "S_min": 100, "S_max": 255, "V_min": 100, "V_max": 255}
        },
        "青色蓝条": {
            "填充色": {"H_min": 80, "H_max": 100, "S_min": 100, "S_max": 255, "V_min": 100, "V_max": 255}
        },
    }
}
