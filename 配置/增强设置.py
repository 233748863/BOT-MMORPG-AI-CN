"""
增强模块配置设置
定义YOLO检测器、状态识别器、决策引擎的配置项
"""

from enum import Enum

# ==================== 实体类型枚举 ====================
class 实体类型枚举(Enum):
    """游戏中可识别的实体类型"""
    怪物 = "monster"
    NPC = "npc"
    玩家 = "player"
    物品 = "item"
    技能特效 = "skill_effect"
    未知 = "unknown"


# ==================== 游戏状态枚举 ====================
class 游戏状态枚举(Enum):
    """游戏状态枚举"""
    战斗 = "combat"
    对话 = "dialogue"
    菜单 = "menu"
    移动 = "moving"
    拾取 = "looting"
    采集 = "gathering"
    死亡 = "dead"
    加载 = "loading"
    空闲 = "idle"
    未知 = "unknown"


# ==================== YOLO检测器设置 ====================
YOLO配置 = {
    "模型路径": "模型/yolo/game_detector.pt",
    "置信度阈值": 0.5,
    "NMS阈值": 0.4,
    "输入尺寸": (640, 640),
    "启用": True,
    "检测间隔": 3,  # 每N帧检测一次
}

# 实体类型映射 (YOLO类别ID -> 实体类型)
实体类型映射 = {
    0: 实体类型枚举.怪物,
    1: 实体类型枚举.NPC,
    2: 实体类型枚举.玩家,
    3: 实体类型枚举.物品,
    4: 实体类型枚举.技能特效,
}


# ==================== 状态识别器设置 ====================
状态识别配置 = {
    "历史长度": 10,
    "置信度累积系数": 0.1,
    "UI检测启用": True,
    "启用": True,
}

# UI元素模板路径
UI模板路径 = {
    "对话框": "资源/ui/dialogue_box.png",
    "菜单": "资源/ui/menu.png",
    "血条": "资源/ui/health_bar.png",
    "死亡界面": "资源/ui/death_screen.png",
    "加载界面": "资源/ui/loading.png",
}

# 状态判定阈值
状态判定阈值 = {
    "战斗_敌人距离": 200,  # 像素
    "战斗_敌人数量": 1,
    "拾取_物品距离": 100,
}


# ==================== 决策引擎设置 ====================
class 决策策略枚举(Enum):
    """决策策略类型"""
    规则优先 = "rule_first"
    模型优先 = "model_first"
    混合加权 = "weighted_mix"


决策引擎配置 = {
    "策略": 决策策略枚举.混合加权,
    "规则权重": 0.6,
    "模型权重": 0.4,
    "启用日志": True,
    "日志长度": 100,
    "启用": True,
}

# 状态-动作权重映射
# 权重值越高，该类型动作在对应状态下越优先
状态动作权重 = {
    游戏状态枚举.战斗: {
        "移动": 1.5,
        "技能": 2.5,
        "特殊": 2.0,
        "鼠标": 2.0,
        "组合": 1.5,
    },
    游戏状态枚举.对话: {
        "移动": 0.1,
        "技能": 0.0,
        "特殊": 0.5,
        "鼠标": 2.5,
        "组合": 0.0,
    },
    游戏状态枚举.菜单: {
        "移动": 0.0,
        "技能": 0.0,
        "特殊": 0.3,
        "鼠标": 3.0,
        "组合": 0.0,
    },
    游戏状态枚举.移动: {
        "移动": 3.0,
        "技能": 0.2,
        "特殊": 0.5,
        "鼠标": 1.0,
        "组合": 0.1,
    },
    游戏状态枚举.拾取: {
        "移动": 1.0,
        "技能": 0.0,
        "特殊": 1.0,
        "鼠标": 2.0,
        "组合": 0.0,
    },
    游戏状态枚举.采集: {
        "移动": 0.1,  # 采集时不应移动
        "技能": 0.0,
        "特殊": 0.3,  # 可能需要取消采集
        "鼠标": 1.5,  # 点击确认等
        "组合": 0.0,
    },
    游戏状态枚举.死亡: {
        "移动": 0.0,
        "技能": 0.0,
        "特殊": 0.5,
        "鼠标": 2.0,  # 点击复活等
        "组合": 0.0,
    },
    游戏状态枚举.加载: {
        "移动": 0.0,
        "技能": 0.0,
        "特殊": 0.0,
        "鼠标": 0.0,
        "组合": 0.0,
    },
    游戏状态枚举.空闲: {
        "移动": 1.0,
        "技能": 0.5,
        "特殊": 1.0,
        "鼠标": 1.5,
        "组合": 0.5,
    },
    游戏状态枚举.未知: {
        "移动": 1.0,
        "技能": 0.5,
        "特殊": 0.5,
        "鼠标": 1.0,
        "组合": 0.5,
    },
}

# 动作冷却时间 (秒)
动作冷却时间 = {
    9: 1.0,   # 技能1
    10: 1.5,  # 技能2
    11: 2.0,  # 技能3
    12: 2.5,  # 技能4
    13: 3.0,  # 技能5
    14: 3.0,  # 技能6
    15: 1.0,  # 技能Q
    16: 1.0,  # 技能E
    17: 2.0,  # 技能R
    18: 2.0,  # 技能F
    19: 0.5,  # 跳跃/闪避
    20: 1.0,  # 切换目标
}

# 紧急规则配置
紧急规则配置 = {
    "低血量阈值": 0.3,
    "被围攻阈值": 3,  # 敌人数量
    "紧急动作": 19,  # 跳跃/闪避
}


# ==================== 模块启用配置 ====================
模块启用配置 = {
    "YOLO检测器": True,
    "状态识别器": True,
    "决策引擎": True,
}

# ==================== 性能配置 ====================
性能配置 = {
    "低性能模式检测间隔": 5,  # 低性能时每N帧检测一次
    "帧率阈值": 15,  # 低于此帧率进入低性能模式
    "自动降级": True,  # 是否自动降级
}
