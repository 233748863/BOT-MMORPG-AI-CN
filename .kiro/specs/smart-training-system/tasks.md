# 实现计划: 智能训练系统

## 概述

本计划将智能录制优化、多游戏配置管理、自动调参系统三个模块分阶段实现，优先完成核心数据结构和基础功能，再逐步添加高级特性。

## 任务

- [x] 1. 创建核心数据结构和基础接口
  - [x] 1.1 创建 `核心/智能录制.py`，定义 RecordingSegment、GameEvent、RecordingStatistics 数据类
    - 使用 dataclass 定义数据结构
    - 实现 value_score 范围验证 (0-100)
    - _需求: 1.6_
  - [x] 1.2 编写属性测试：价值评分范围约束

    - **Property 1: 价值评分范围约束**
    - **验证: 需求 1.6**
  - [x] 1.3 创建 `核心/配置管理.py`，定义 GameProfile、WindowConfig、KeyMapping、UIRegions 等数据类
    - 实现配置数据结构的完整性验证
    - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_
  - [x] 1.4 编写属性测试：配置档案完整性

    - **Property 8: 配置档案完整性**
    - **验证: 需求 5.1, 5.2, 5.3, 5.4, 5.5**
  - [x] 1.5 创建 `核心/自动调参.py`，定义 PerformanceMetric、ParameterSpace、TuningRecord、AggressivenessLevel
    - 实现参数范围验证
    - _需求: 8.1, 8.2_

- [x] 2. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 3. 实现智能录制模块 - 价值评估器
  - [x] 3.1 实现 ValueEvaluator 类
    - 实现 evaluate_segment 方法计算片段价值
    - 实现 classify_event 方法分类事件
    - _需求: 1.2, 1.3, 1.4, 1.5_
  - [x] 3.2 编写属性测试：事件类型与价值等级映射一致性

    - **Property 2: 事件类型与价值等级映射一致性**
    - **验证: 需求 1.2, 1.3, 1.4, 1.5**

- [x] 4. 实现智能录制模块 - 数据过滤器
  - [x] 4.1 实现 DataFilter 类
    - 实现 is_idle 方法检测空闲状态
    - 实现 is_repetitive 方法检测重复操作
    - 实现 is_stuck 方法检测卡住状态
    - 实现 is_loading 方法检测加载画面
    - _需求: 2.1, 2.2, 2.3, 2.4_
  - [x] 4.2 编写属性测试：空闲检测正确性

    - **Property 3: 空闲检测正确性**
    - **验证: 需求 2.1**
  - [x] 4.3 编写属性测试：重复操作检测正确性

    - **Property 4: 重复操作检测正确性**
    - **验证: 需求 2.2**

- [x] 5. 实现智能录制模块 - 统计服务
  - [x] 5.1 实现录制统计计算功能
    - 实现高/中/低价值片段计数
    - 实现动作分布统计
    - 实现数据质量报告生成
    - _需求: 3.2, 3.3, 3.4, 3.5_
  - [x] 5.2 编写属性测试：统计计算一致性

    - **Property 5: 统计计算一致性**
    - **验证: 需求 3.2**

- [x] 6. 检查点 - 确保智能录制模块测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 7. 实现配置管理模块 - 档案存储
  - [x] 7.1 实现 ConfigManager 类的 CRUD 操作
    - 实现 create_profile 创建新档案
    - 实现 save_profile 保存档案
    - 实现 load_profile 加载档案
    - 实现 delete_profile 删除档案
    - 实现 list_profiles 列出所有档案
    - _需求: 4.1, 4.2, 4.3, 4.6_
  - [x] 7.2 编写属性测试：配置档案CRUD一致性

    - **Property 6: 配置档案CRUD一致性**
    - **验证: 需求 4.1, 4.2, 4.3, 4.6**

- [x] 8. 实现配置管理模块 - 导入导出
  - [x] 8.1 实现配置导入导出功能
    - 实现 export_profile 导出为JSON
    - 实现 import_profile 从JSON导入
    - _需求: 4.4, 4.5_
  - [x] 8.2 编写属性测试：配置导入导出Round-Trip

    - **Property 7: 配置导入导出Round-Trip**
    - **验证: 需求 4.4, 4.5**

- [x] 9. 实现配置管理模块 - 配置切换
  - [x] 9.1 实现配置切换和持久化功能
    - 实现 switch_profile 切换当前档案
    - 实现 get_current_profile 获取当前档案
    - 实现上次使用档案的持久化和自动加载
    - _需求: 6.2, 6.4_
  - [x] 9.2 编写属性测试：配置切换即时生效

    - **Property 9: 配置切换即时生效**
    - **验证: 需求 6.2**
  - [x] 9.3 编写属性测试：上次配置持久化

    - **Property 10: 上次配置持久化**
    - **验证: 需求 6.4**

- [x] 10. 检查点 - 确保配置管理模块测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 11. 实现自动调参模块 - 指标收集
  - [x] 11.1 实现性能指标收集和汇总功能
    - 实现 collect_metric 收集指标
    - 实现 get_aggregated_metrics 汇总指标
    - 实现指标持久化存储
    - _需求: 7.1, 7.2, 7.4_
  - [x] 11.2 编写属性测试：性能指标汇总正确性

    - **Property 11: 性能指标汇总正确性**
    - **验证: 需求 7.2**
  - [x] 11.3 编写属性测试：性能数据持久化Round-Trip

    - **Property 12: 性能数据持久化Round-Trip**
    - **验证: 需求 7.4**

- [x] 12. 实现自动调参模块 - 参数优化器
  - [x] 12.1 实现参数调整核心逻辑
    - 实现 tune_parameter 调整参数
    - 实现 is_performance_degraded 判断性能变化
    - 实现渐进式调整策略
    - _需求: 8.3, 8.4, 8.5, 8.6_
  - [x] 12.2 编写属性测试：参数调整范围约束

    - **Property 13: 参数调整范围约束**
    - **验证: 需求 8.1, 8.3**
  - [x] 12.3 编写属性测试：参数保留/回滚决策正确性

    - **Property 14: 参数保留/回滚决策正确性**
    - **验证: 需求 8.4, 8.5**
  - [ ]* 12.4 编写属性测试：渐进式调整约束
    - **Property 15: 渐进式调整约束**
    - **验证: 需求 8.6, 9.2**

- [x] 13. 实现自动调参模块 - 用户控制
  - [x] 13.1 实现参数锁定和重置功能
    - 实现 lock_parameter / unlock_parameter 锁定/解锁参数
    - 实现 reset_to_defaults 重置为默认值
    - 实现 get_parameter_diff 获取参数差异
    - _需求: 9.3, 9.5, 9.6_
  - [ ]* 13.2 编写属性测试：参数锁定有效性
    - **Property 16: 参数锁定有效性**
    - **验证: 需求 9.3**
  - [ ]* 13.3 编写属性测试：默认值恢复正确性
    - **Property 17: 默认值恢复正确性**
    - **验证: 需求 9.5**
  - [ ]* 13.4 编写属性测试：参数差异计算正确性
    - **Property 18: 参数差异计算正确性**
    - **验证: 需求 9.6**

- [x] 14. 检查点 - 确保自动调参模块测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 15. 模块集成
  - [x] 15.1 将智能录制模块集成到数据收集流程
    - 修改 `训练/收集数据.py` 集成 Smart_Recorder
    - 添加价值评分显示和过滤选项
    - _需求: 10.1_
  - [x] 15.2 将配置管理模块集成到现有配置系统
    - 确保与 `配置/设置.py` 兼容
    - 实现配置迁移逻辑
    - _需求: 10.2_
  - [x] 15.3 将自动调参模块集成到决策引擎
    - 修改 `核心/决策引擎.py` 集成 Auto_Tuner
    - 实现实时参数应用
    - _需求: 10.3_
  - [x] 15.4 实现错误降级机制
    - 任一模块出错时降级到基础功能
    - _需求: 10.4_

- [x] 16. GUI界面集成
  - [x] 16.1 在GUI中添加智能录制控制面板
    - 显示实时价值评分
    - 添加过滤选项控件
    - _需求: 2.6, 3.1_
  - [x] 16.2 在GUI中添加配置管理界面
    - 添加档案选择下拉框
    - 添加导入导出按钮
    - _需求: 6.1, 6.3, 6.5_
  - [x] 16.3 在GUI中添加自动调参控制面板
    - 添加启用/禁用开关
    - 添加激进程度选择
    - 添加参数锁定控件
    - _需求: 9.1, 9.2_

- [x] 17. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

## 备注

- 标记 `*` 的任务为可选任务，可跳过以加快MVP开发
- 每个任务都引用了具体的需求编号以便追溯
- 检查点任务用于确保增量验证
- 属性测试验证通用正确性属性
- 单元测试验证具体示例和边界情况

