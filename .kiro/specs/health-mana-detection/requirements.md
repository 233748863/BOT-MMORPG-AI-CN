# 需求文档

## 简介

血量/蓝量检测功能，通过图像识别技术检测游戏界面中的血条和蓝条，获取角色当前的生命值和魔法值百分比，使决策引擎的紧急规则能够正常工作。

## 术语表

- **血量检测器**: 负责识别和计算血量百分比的模块
- **蓝量检测器**: 负责识别和计算蓝量百分比的模块
- **状态条**: 游戏界面中显示血量/蓝量的 UI 元素
- **感兴趣区域**: 状态条在屏幕上的位置区域

## 需求列表

### 需求 1: 血条区域配置

**用户故事:** 作为用户，我希望能配置血条位置，以便系统能检测我游戏的血条。

#### 验收标准

1. 血量检测器应支持配置血条感兴趣区域（x, y, 宽度, 高度）
2. 血量检测器应提供校准工具帮助用户选择区域
3. 校准时，系统应显示带有选中区域高亮的预览
4. 血量检测器应将区域配置保存到配置文件
5. 血量检测器应支持为不同游戏设置不同的区域配置

### 需求 2: 颜色检测方法

**用户故事:** 作为开发者，我希望使用颜色分析检测血量百分比，以便适用于大多数游戏。

#### 验收标准

1. 血量检测器应通过分析像素颜色检测血条填充程度
2. 血量检测器应支持可配置的血条颜色（默认：红色/绿色）
3. 血量检测器应通过比较填充像素与空白像素计算填充百分比
4. 血量检测器应处理渐变颜色过渡（如绿色到黄色到红色）
5. 血量检测器应返回 0.0 到 1.0 之间的值

### 需求 3: 蓝量检测

**用户故事:** 作为用户，我希望检测蓝量/能量百分比，以便 AI 能管理技能使用。

#### 验收标准

1. 蓝量检测器应支持单独配置蓝条感兴趣区域
2. 蓝量检测器应使用颜色分析检测蓝条填充程度（默认：蓝色）
3. 蓝量检测器应返回 0.0 到 1.0 之间的值
4. 如果未配置蓝条，蓝量检测器应返回 1.0（满蓝）

### 需求 4: 检测稳定性

**用户故事:** 作为开发者，我希望检测结果稳定，以便 AI 不会对噪声做出反应。

#### 验收标准

1. 血量检测器应应用平滑处理以避免结果闪烁
2. 血量检测器应使用最近 N 帧的移动平均（默认：5 帧）
3. 当血量显著变化（>10%）时，血量检测器应立即更新
4. 血量检测器应优雅地处理血条部分遮挡的情况

### 需求 5: 决策引擎集成

**用户故事:** 作为开发者，我希望将血量检测与决策引擎集成，以便紧急规则能正常工作。

#### 验收标准

1. 血量检测器应提供获取当前血量百分比的方法
2. 决策引擎应在每个决策周期前调用血量检测器
3. 当血量低于紧急阈值时，决策引擎应触发紧急规则
4. 血量检测器应记录血量变化以便调试

### 需求 6: 检测失败处理

**用户故事:** 作为开发者，我希望检测失败时能优雅处理，以便 AI 继续运行。

#### 验收标准

1. 如果无法检测到血条，血量检测器应返回上次已知值
2. 如果检测失败超过 5 秒，血量检测器应返回 1.0（假设满血）
3. 血量检测器应记录检测失败及诊断信息
4. 血量检测器应为每次检测结果提供置信度分数
