# 设计文档

## 概述

本设计文档描述对MMORPG游戏AI助手GUI界面的全面布局适配调整方案。基于现有PySide6实现，优化各页面的组件排列、间距、对齐方式，在800x600固定窗口尺寸下实现更合理的空间分配和更好的视觉效果。

## 架构

### 布局系统设计

采用统一的布局常量和网格系统，确保整个应用的视觉一致性：

```
┌─────────────────────────────────────────────────────────────┐
│                    主窗口 800x600                            │
├────────┬────────────────────────────────────────────────────┤
│        │                                                    │
│ 导航栏  │              主内容区域                             │
│ 100px  │              680x560                               │
│        │   ┌────────────────────────────────────────────┐   │
│ 🏠 首页 │   │  外边距: 16px                               │   │
│        │   │  ┌──────────────────────────────────────┐  │   │
│ 🎥 数据 │   │  │                                      │  │   │
│        │   │  │     页面内容区域                       │  │   │
│ 🧠 训练 │   │  │     648x528                          │  │   │
│        │   │  │                                      │  │   │
│ 🤖 运行 │   │  └──────────────────────────────────────┘  │   │
│        │   └────────────────────────────────────────────┘   │
│ ⚙️ 配置 │                                                    │
│        │                                                    │
│ 📁 管理 │                                                    │
│        │                                                    │
├────────┴────────────────────────────────────────────────────┤
│                    状态栏 24px                               │
└─────────────────────────────────────────────────────────────┘
```

### 布局常量定义

```python
class 布局常量:
    """统一的布局常量"""
    
    # 窗口尺寸
    窗口宽度 = 800
    窗口高度 = 600
    
    # 导航栏
    导航栏宽度 = 100
    导航项高度 = 40
    导航项间距 = 4
    导航项内边距 = 8
    
    # 内容区域
    内容区外边距 = 16
    内容区宽度 = 668  # 800 - 100 - 16*2
    内容区高度 = 544  # 600 - 24(状态栏) - 16*2
    
    # 卡片组件
    卡片圆角 = 8
    卡片内边距 = 12
    卡片间距 = 12
    卡片边框宽度 = 1
    卡片最小高度 = 80
    
    # 标题
    页面标题字号 = 18
    卡片标题字号 = 13
    标题下边距 = 8
    
    # 按钮
    按钮高度 = 32
    按钮最小宽度 = 60
    按钮最大宽度 = 100
    按钮圆角 = 6
    按钮水平内边距 = 12
    按钮间距 = 8
    
    # 表单
    表单标签宽度 = 80
    表单控件高度 = 28
    表单控件最小宽度 = 80
    表单行间距 = 8
    
    # 文字
    正文字号 = 12
    次要文字字号 = 11
    最小文字字号 = 10
```

### 尺寸约束规范

为确保UI元素不会出现过大、过小或显示不全的问题，定义以下约束：

#### 文字尺寸约束

| 元素类型 | 字号范围 | 推荐值 | 说明 |
|---------|---------|-------|------|
| 页面标题 | 16-20px | 18px | 每页顶部的主标题 |
| 卡片标题 | 12-14px | 13px | 卡片内的标题 |
| 正文内容 | 11-13px | 12px | 普通文字内容 |
| 次要文字 | 10-12px | 11px | 提示、说明文字 |
| 状态标签 | 10-12px | 11px | 状态值显示 |
| 按钮文字 | 12-13px | 12px | 按钮上的文字 |

#### 按钮尺寸约束

| 按钮类型 | 宽度范围 | 高度 | 说明 |
|---------|---------|------|------|
| 主要操作按钮 | 60-80px | 32px | 开始、停止等 |
| 次要操作按钮 | 50-70px | 32px | 暂停、继续等 |
| 工具按钮 | 32-40px | 32px | 图标按钮 |
| 快捷卡片按钮 | 120-140px | 80-90px | 首页快捷操作 |

#### 组件尺寸约束

| 组件类型 | 最小尺寸 | 最大尺寸 | 说明 |
|---------|---------|---------|------|
| 卡片组件 | 150x80px | 无限制 | 根据内容自适应 |
| 下拉框 | 100x28px | 200x28px | 固定高度 |
| 输入框 | 80x28px | 200x28px | 固定高度 |
| 预览区域 | 200x112px | 280x158px | 保持16:9比例 |
| 进度条 | 100x6px | 无限制x8px | 高度固定 |

#### 布局空间分配

```
800x600 窗口空间分配:
├── 导航栏: 100px (固定)
├── 内容区域: 668px
│   ├── 外边距: 16px x 2 = 32px
│   └── 可用宽度: 636px
│       ├── 左栏 (60%): ~382px
│       ├── 间距: 12px
│       └── 右栏 (40%): ~242px
└── 状态栏: 24px (固定)

垂直空间分配:
├── 页面标题区: 40px (标题+下边距)
├── 内容区域: ~480px
│   ├── 上部卡片: ~200px
│   ├── 间距: 12px
│   └── 下部卡片: ~268px
└── 底部说明: ~60px
```

#### 防止显示问题的设计原则

1. **文字截断处理**
   - 长文本使用省略号(...)截断
   - 关键信息不截断，使用换行
   - 工具提示显示完整内容

2. **组件溢出处理**
   - 内容超出时显示滚动条
   - 使用QScrollArea包装可能溢出的区域
   - 设置最小尺寸防止过度压缩

3. **自适应布局**
   - 使用伸展因子(stretch)而非固定尺寸
   - 关键组件设置最小尺寸
   - 次要组件允许压缩

4. **边距保护**
   - 所有组件保持最小8px边距
   - 文字与边框保持4px以上间距
   - 按钮内文字保持8px水平内边距

## 组件和接口

### 1. 优化后的导航栏组件

```python
class NavigationBar(QListWidget):
    """优化后的导航栏组件"""
    
    def __init__(self, parent=None):
        super().__init__(parent)
        self.setFixedWidth(布局常量.导航栏宽度)
        self._应用样式()
    
    def _应用样式(self) -> None:
        """应用优化后的样式"""
        self.setStyleSheet(f"""
            QListWidget {{
                background-color: {颜色.卡片背景};
                border: none;
                border-right: 1px solid {颜色.边框};
                padding: 8px 0;
            }}
            QListWidget::item {{
                height: {布局常量.导航项高度}px;
                padding: 0 {布局常量.导航项内边距}px;
                margin: {布局常量.导航项间距}px 6px;
                border-radius: 6px;
            }}
            QListWidget::item:selected {{
                background-color: {颜色.选中背景};
                color: {颜色.主色};
                border-left: 3px solid {颜色.主色};
            }}
            QListWidget::item:hover:!selected {{
                background-color: {颜色.悬停背景};
            }}
        """)
```

### 2. 通用卡片组件

```python
class Card(QFrame):
    """通用卡片组件"""
    
    def __init__(self, 标题: str = "", 图标: str = "", parent=None):
        super().__init__(parent)
        self._标题 = 标题
        self._图标 = 图标
        self._初始化样式()
        self._初始化布局()
    
    def _初始化样式(self) -> None:
        """初始化卡片样式"""
        self.setStyleSheet(f"""
            QFrame {{
                background-color: {颜色.卡片背景};
                border-radius: {布局常量.卡片圆角}px;
                border: {布局常量.卡片边框宽度}px solid {颜色.边框};
            }}
        """)
    
    def _初始化布局(self) -> None:
        """初始化卡片布局"""
        self._主布局 = QVBoxLayout(self)
        self._主布局.setContentsMargins(
            布局常量.卡片内边距,
            布局常量.卡片内边距,
            布局常量.卡片内边距,
            布局常量.卡片内边距
        )
        self._主布局.setSpacing(8)
        
        if self._标题:
            标题文本 = f"{self._图标} {self._标题}" if self._图标 else self._标题
            标题标签 = QLabel(标题文本)
            标题标签.setStyleSheet(f"""
                font-size: {布局常量.卡片标题字号}px;
                font-weight: bold;
                color: {颜色.标题};
                padding-bottom: 4px;
            """)
            self._主布局.addWidget(标题标签)
    
    def 添加内容(self, widget: QWidget) -> None:
        """添加内容组件"""
        self._主布局.addWidget(widget)
    
    def 添加布局(self, layout: QLayout) -> None:
        """添加布局"""
        self._主布局.addLayout(layout)
```

### 3. 数据收集页布局优化

```
┌─────────────────────────────────────────────────────────────┐
│  🎥 数据收集                                                 │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────┐  ┌───────────────────────────┐ │
│  │ 🎮 控制面板              │  │ 🎯 智能录制                │ │
│  │ ┌─────────────────────┐ │  │ 当前价值评分: 85.2        │ │
│  │ │ 训练模式: [主线任务▼]│ │  │ ████████████░░░░ 高价值   │ │
│  │ └─────────────────────┘ │  │ 等级: 高价值              │ │
│  │ [开始] [暂停] [停止]    │  │ ─────────────────────     │ │
│  │ 💡 T暂停/继续, ESC停止  │  │ 🟢高价值: 12  🟡中价值: 5 │ │
│  └─────────────────────────┘  │ 🔴低价值: 3   📊总计: 20  │ │
│  ┌─────────────────────────┐  │ ─────────────────────     │ │
│  │ 📊 状态监控              │  │ 保存选项: [保留全部▼]     │ │
│  │ 录制状态: 录制中  样本: 156│  └───────────────────────────┘ │
│  │ 文件编号: 1     帧率: 30 │  ┌───────────────────────────┐ │
│  │ 当前动作: 前进           │  │ 🖥️ 游戏画面预览            │ │
│  └─────────────────────────┘  │ ┌───────────────────────┐ │ │
│                               │ │                       │ │ │
│                               │ │    [预览画面区域]      │ │ │
│                               │ │      16:9 比例        │ │ │
│                               │ │                       │ │ │
│                               │ └───────────────────────┘ │ │
│                               └───────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  📋 操作说明                                                 │
│  1. 选择训练模式 → 2. 点击开始录制 → 3. 切换到游戏窗口...    │
└─────────────────────────────────────────────────────────────┘
```

布局代码：

```python
class 数据收集页(QWidget):
    """优化后的数据收集页面"""
    
    def _初始化界面(self) -> None:
        主布局 = QVBoxLayout(self)
        主布局.setContentsMargins(布局常量.内容区外边距, 布局常量.内容区外边距,
                                布局常量.内容区外边距, 布局常量.内容区外边距)
        主布局.setSpacing(布局常量.卡片间距)
        
        # 页面标题
        标题 = QLabel("🎥 数据收集")
        标题.setStyleSheet(f"font-size: {布局常量.页面标题字号}px; font-weight: bold;")
        主布局.addWidget(标题)
        
        # 内容区域 - 左右两栏
        内容容器 = QWidget()
        内容布局 = QHBoxLayout(内容容器)
        内容布局.setContentsMargins(0, 0, 0, 0)
        内容布局.setSpacing(布局常量.卡片间距)
        
        # 左栏 (60%)
        左栏 = QWidget()
        左栏布局 = QVBoxLayout(左栏)
        左栏布局.setContentsMargins(0, 0, 0, 0)
        左栏布局.setSpacing(布局常量.卡片间距)
        
        左栏布局.addWidget(self._创建控制面板())
        左栏布局.addWidget(self._创建状态监控())
        左栏布局.addStretch()
        
        内容布局.addWidget(左栏, 60)
        
        # 右栏 (40%)
        右栏 = QWidget()
        右栏布局 = QVBoxLayout(右栏)
        右栏布局.setContentsMargins(0, 0, 0, 0)
        右栏布局.setSpacing(布局常量.卡片间距)
        
        右栏布局.addWidget(self._创建智能录制面板())
        右栏布局.addWidget(self._创建画面预览(), 1)
        
        内容布局.addWidget(右栏, 40)
        
        主布局.addWidget(内容容器, 1)
        
        # 底部操作说明
        主布局.addWidget(self._创建操作说明())
```

### 4. 训练页布局优化

```
┌─────────────────────────────────────────────────────────────┐
│  🧠 模型训练                                                 │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────┐  ┌───────────────────────────┐ │
│  │ ⚙️ 训练设置              │  │ 📈 训练进度                │ │
│  │ 训练模式: [主线任务▼]    │  │ 进度: ████████░░░░ 75%    │ │
│  │ 训练轮次: [10    ]       │  │ 当前轮次: 8 / 10          │ │
│  │ 批次大小: [32    ]       │  │ 当前损失: 0.0234          │ │
│  │ 学习率:   [0.001 ]       │  │ 预计剩余: 00:05:32        │ │
│  │ ─────────────────────   │  │ ─────────────────────     │ │
│  │ [开始训练] [停止训练]    │  │ 📊 损失曲线               │ │
│  └─────────────────────────┘  │ ┌───────────────────────┐ │ │
│                               │ │ ╲                     │ │ │
│                               │ │  ╲___                 │ │ │
│                               │ │      ╲___╱╲___       │ │ │
│                               │ └───────────────────────┘ │ │
│                               └───────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  📝 训练日志                                                 │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ [12:30:01] 开始训练，模式: 主线任务                       ││
│  │ [12:30:05] Epoch 1/10, Loss: 0.5234                     ││
│  │ [12:30:45] Epoch 2/10, Loss: 0.3456                     ││
│  │ ...                                                     ││
│  └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
```

### 5. 运行页布局优化

```
┌─────────────────────────────────────────────────────────────┐
│  🤖 机器人运行                                               │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────┐  ┌───────────────────────────┐ │
│  │ 🎮 运行模式              │  │ 📊 运行状态                │ │
│  │ 运行模式: [增强模式▼]    │  │ 当前动作: 前进            │ │
│  │ 子模式:   [主线任务▼]    │  │ 动作来源: model           │ │
│  │ ─────────────────────   │  │ 游戏状态: 移动中          │ │
│  │ [启动] [暂停] [停止]     │  │ ─────────────────────     │ │
│  │ 💡 T暂停/继续, ESC停止   │  │ 帧率: 30.0 FPS           │ │
│  └─────────────────────────┘  │ 运动量: 0.85              │ │
│  ┌─────────────────────────┐  └───────────────────────────┘ │
│  │ 🔧 增强模块状态          │  ┌───────────────────────────┐ │
│  │ ┌─────┐ ┌─────┐ ┌─────┐│  │ 📝 运行日志                │ │
│  │ │YOLO │ │状态 │ │决策 ││  │ ┌───────────────────────┐ │ │
│  │ │ ✅  │ │识别 │ │引擎 ││  │ │ [12:30:01] 启动机器人  │ │ │
│  │ │     │ │ ✅  │ │ ✅  ││  │ │ [12:30:02] 检测到NPC   │ │ │
│  │ └─────┘ └─────┘ └─────┘│  │ │ [12:30:03] 执行对话    │ │ │
│  │ ┌─────┐ ┌─────┐       │  │ │ ...                    │ │ │
│  │ │脱困 │ │自动 │       │  │ └───────────────────────┘ │ │
│  │ │ ✅  │ │调参 │       │  └───────────────────────────┘ │
│  │ │     │ │ ⚠️  │       │                               │
│  │ └─────┘ └─────┘       │                               │
│  └─────────────────────────┘                               │
└─────────────────────────────────────────────────────────────┘
```

### 6. 配置页布局优化

```
┌─────────────────────────────────────────────────────────────┐
│  ⚙️ 配置管理                                                 │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐│
│  │ [游戏窗口] [模型设置] [训练参数] [增强模块]              ││
│  ├─────────────────────────────────────────────────────────┤│
│  │                                                         ││
│  │  📐 窗口设置                                            ││
│  │  ─────────────────────────────────────────────────     ││
│  │  窗口标题:     [游戏窗口名称          ]                 ││
│  │  截取区域X:    [0        ]  截取区域Y:  [0        ]     ││
│  │  截取宽度:     [800      ]  截取高度:   [600      ]     ││
│  │                                                         ││
│  │  🖼️ 图像设置                                            ││
│  │  ─────────────────────────────────────────────────     ││
│  │  缩放宽度:     [160      ]  缩放高度:   [90       ]     ││
│  │  灰度模式:     [✓]                                      ││
│  │                                                         ││
│  └─────────────────────────────────────────────────────────┘│
├─────────────────────────────────────────────────────────────┤
│                              [重置默认]  [保存配置]          │
└─────────────────────────────────────────────────────────────┘
```

### 7. 首页布局优化

```
┌─────────────────────────────────────────────────────────────┐
│  🎮 MMORPG游戏AI助手                                         │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐│
│  │ 📊 系统状态                                              ││
│  │ 模型状态: ✅ 已加载    GPU: ✅ 可用 (RTX 3080)          ││
│  │ 数据文件: 📁 12个文件 (6000样本)                         ││
│  │ 上次训练: 2025-01-01 12:30 (损失: 0.023)                ││
│  └─────────────────────────────────────────────────────────┘│
│                                                             │
│  快捷操作                                                    │
│  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐   │
│  │    ▶️     │ │    🎥     │ │    🧠     │ │    📁     │   │
│  │ 快速运行  │ │ 开始录制  │ │ 训练模型  │ │ 数据管理  │   │
│  │ 启动AI    │ │ 收集数据  │ │ 训练AI    │ │ 管理数据  │   │
│  └───────────┘ └───────────┘ └───────────┘ └───────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ 💡 提示: 系统就绪，可以启动AI机器人了                     ││
│  └─────────────────────────────────────────────────────────┘│
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ ⌨️ 快捷键                                                ││
│  │ T - 暂停/继续  |  ESC - 停止  |  Ctrl+S - 保存配置       ││
│  └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
```

## 数据模型

### 布局配置数据模型

```python
from dataclasses import dataclass
from typing import Tuple

@dataclass
class 卡片配置:
    """卡片组件配置"""
    标题: str = ""
    图标: str = ""
    最小高度: int = 0
    最大高度: int = 0
    固定宽度: int = 0
    伸展因子: int = 0

@dataclass
class 页面布局配置:
    """页面布局配置"""
    页面名称: str
    标题: str
    图标: str
    布局类型: str  # "左右两栏", "上下两区", "标签页", "仪表盘"
    左栏比例: int = 50
    右栏比例: int = 50
    上区比例: int = 60
    下区比例: int = 40
```



## 动画和过渡效果设计

### 动画设计原则

1. **自然流畅**: 使用缓动函数(easing)实现自然的加速和减速
2. **时长适中**: 动画时长控制在150-300ms，避免过快或过慢
3. **性能优先**: 优先使用CSS/QSS动画，避免阻塞主线程
4. **可中断**: 动画可被用户操作中断，不影响交互

### 过渡效果规范

| 交互类型 | 动画效果 | 时长 | 缓动函数 |
|---------|---------|------|---------|
| 页面切换 | 淡入淡出 | 200ms | ease-out |
| 按钮悬停 | 背景色渐变 | 150ms | ease |
| 按钮点击 | 缩放+颜色变化 | 100ms | ease-in |
| 卡片悬停 | 边框颜色渐变 | 150ms | ease |
| 导航项选中 | 背景色+左边框 | 200ms | ease-out |
| 进度条更新 | 宽度渐变 | 300ms | ease-out |
| 通知弹出 | 从右滑入 | 250ms | ease-out |
| 通知消失 | 淡出 | 200ms | ease-in |

### 动画实现方案

```python
from PySide6.QtCore import QPropertyAnimation, QEasingCurve, QParallelAnimationGroup
from PySide6.QtWidgets import QGraphicsOpacityEffect

class 动画管理器:
    """统一的动画管理器"""
    
    # 动画时长常量
    快速动画 = 150
    标准动画 = 200
    慢速动画 = 300
    
    @staticmethod
    def 创建淡入动画(widget, 时长: int = 200) -> QPropertyAnimation:
        """创建淡入动画"""
        效果 = QGraphicsOpacityEffect(widget)
        widget.setGraphicsEffect(效果)
        
        动画 = QPropertyAnimation(效果, b"opacity")
        动画.setDuration(时长)
        动画.setStartValue(0.0)
        动画.setEndValue(1.0)
        动画.setEasingCurve(QEasingCurve.OutCubic)
        return 动画
    
    @staticmethod
    def 创建页面切换动画(旧页面, 新页面, 时长: int = 200) -> QParallelAnimationGroup:
        """创建页面切换动画组"""
        动画组 = QParallelAnimationGroup()
        
        # 旧页面淡出
        淡出 = 动画管理器.创建淡出动画(旧页面, 时长)
        动画组.addAnimation(淡出)
        
        # 新页面淡入
        淡入 = 动画管理器.创建淡入动画(新页面, 时长)
        动画组.addAnimation(淡入)
        
        return 动画组
```

### 按钮悬停效果样式

```python
按钮悬停样式 = """
QPushButton {
    background-color: #3B82F6;
    transition: background-color 150ms ease;
}
QPushButton:hover {
    background-color: #2563EB;
}
QPushButton:pressed {
    background-color: #1D4ED8;
    transform: scale(0.98);
}
"""
```

## UI加载性能优化

### 性能优化策略

#### 1. 延迟加载 (Lazy Loading)

```python
class 延迟加载页面管理器:
    """页面延迟加载管理器"""
    
    def __init__(self):
        self._页面缓存 = {}
        self._页面类映射 = {
            "首页": 首页,
            "数据收集": 数据收集页,
            "训练": 训练页,
            "运行": 运行页,
            "配置": 配置页,
            "数据管理": 数据管理页,
        }
    
    def 获取页面(self, 页面名称: str) -> QWidget:
        """按需创建页面，已创建的从缓存获取"""
        if 页面名称 not in self._页面缓存:
            页面类 = self._页面类映射.get(页面名称)
            if 页面类:
                self._页面缓存[页面名称] = 页面类()
        return self._页面缓存.get(页面名称)
```

#### 2. 异步初始化

```python
from PySide6.QtCore import QTimer

class 主窗口(QMainWindow):
    def __init__(self):
        super().__init__()
        # 先显示基础框架
        self._初始化基础框架()
        self.show()
        
        # 延迟初始化其他组件
        QTimer.singleShot(0, self._延迟初始化)
    
    def _初始化基础框架(self):
        """初始化导航栏和首页（快速）"""
        self._创建导航栏()
        self._创建首页()
    
    def _延迟初始化(self):
        """延迟初始化其他页面和功能"""
        self._初始化状态检测()
        self._绑定快捷键()
```

#### 3. 样式表优化

```python
class 样式管理器:
    """样式表管理器 - 避免重复解析"""
    
    _缓存样式 = None
    
    @classmethod
    def 获取全局样式(cls) -> str:
        """获取缓存的全局样式表"""
        if cls._缓存样式 is None:
            cls._缓存样式 = cls._编译样式()
        return cls._缓存样式
    
    @staticmethod
    def _编译样式() -> str:
        """编译样式表（只执行一次）"""
        return LIGHT_THEME_QSS
```

#### 4. 图像处理优化

```python
from PySide6.QtCore import QThread, Signal
from PySide6.QtGui import QPixmap

class 图像处理线程(QThread):
    """后台图像处理线程"""
    
    图像就绪 = Signal(QPixmap)
    
    def __init__(self, 图像数据):
        super().__init__()
        self._图像数据 = 图像数据
    
    def run(self):
        """在后台线程处理图像"""
        # 图像缩放和转换在后台进行
        像素图 = self._处理图像(self._图像数据)
        self.图像就绪.emit(像素图)
```

#### 5. 状态更新节流

```python
class 状态更新节流器:
    """状态更新节流器 - 避免过于频繁的UI更新"""
    
    def __init__(self, 最小间隔ms: int = 50):
        self._最小间隔 = 最小间隔ms
        self._上次更新时间 = 0
        self._待更新数据 = None
        self._定时器 = QTimer()
        self._定时器.setSingleShot(True)
        self._定时器.timeout.connect(self._执行更新)
    
    def 请求更新(self, 数据: dict, 更新回调):
        """请求更新，自动节流"""
        当前时间 = time.time() * 1000
        
        if 当前时间 - self._上次更新时间 >= self._最小间隔:
            # 立即更新
            更新回调(数据)
            self._上次更新时间 = 当前时间
        else:
            # 延迟更新
            self._待更新数据 = 数据
            self._更新回调 = 更新回调
            if not self._定时器.isActive():
                剩余时间 = self._最小间隔 - (当前时间 - self._上次更新时间)
                self._定时器.start(int(剩余时间))
```

### 性能指标目标

| 指标 | 目标值 | 说明 |
|-----|-------|------|
| 首次加载时间 | < 500ms | 从启动到显示首页 |
| 页面切换时间 | < 100ms | 导航切换响应时间 |
| 状态更新延迟 | < 50ms | 从数据变化到UI更新 |
| 帧率 | ≥ 30fps | 动画和预览流畅度 |
| 内存占用 | < 200MB | 正常运行时内存 |

### 性能监控

```python
class 性能监控器:
    """UI性能监控器"""
    
    def __init__(self):
        self._帧计数 = 0
        self._上次统计时间 = time.time()
    
    def 记录帧(self):
        """记录一帧渲染"""
        self._帧计数 += 1
        当前时间 = time.time()
        
        if 当前时间 - self._上次统计时间 >= 1.0:
            帧率 = self._帧计数 / (当前时间 - self._上次统计时间)
            if 帧率 < 30:
                logging.warning(f"UI帧率过低: {帧率:.1f} FPS")
            self._帧计数 = 0
            self._上次统计时间 = 当前时间
```

## 正确性属性

*正确性属性是指在系统所有有效执行中都应保持为真的特征或行为——本质上是关于系统应该做什么的形式化陈述。属性作为人类可读规范和机器可验证正确性保证之间的桥梁。*

### Property 1: 布局间距一致性
*对于任意* 页面的内容区域，其外边距应为16px；*对于任意* 卡片组件，其内边距应为12px，卡片之间的间距应为12px
**Validates: Requirements 1.2, 1.3, 1.4**

### Property 2: 页面布局比例一致性
*对于任意* 采用左右两栏布局的页面，数据收集页的左右栏比例应为60:40，运行页的左右栏比例应为50:50，数据管理页的左右栏比例应为65:35
**Validates: Requirements 2.1, 4.1, 7.1**

### Property 3: 预览区域宽高比
*对于任意* 游戏画面预览区域，其宽高比应保持为16:9
**Validates: Requirements 2.5**

### Property 4: 导航栏样式一致性
*对于任意* 导航栏组件，其固定宽度应为100px；*对于任意* 导航项，其垂直间距应为指定值，选中项应有明显的视觉区分样式
**Validates: Requirements 8.1, 8.2, 8.4, 8.5**

### Property 5: 卡片样式一致性
*对于任意* 卡片组件，其圆角应为8px，边框应为1px的#E2E8F0颜色，背景应为#FFFFFF；*对于任意* 卡片标题，其字号应为13px加粗，与内容间距应为8px
**Validates: Requirements 9.1, 9.2, 9.3, 9.4, 9.5, 9.6**

### Property 6: 按钮样式一致性
*对于任意* 主要按钮，其背景色应为#3B82F6，文字颜色应为白色；*对于任意* 危险按钮，其背景色应为#EF4444；*对于任意* 禁用按钮，其背景色应为#CBD5E1；*对于任意* 按钮，其圆角应为6px
**Validates: Requirements 10.1, 10.2, 10.3, 10.4, 10.5**

### Property 7: 快捷按钮内容完整性
*对于任意* 首页快捷操作按钮，其应包含图标、标题和描述信息
**Validates: Requirements 6.4**

### Property 8: 文字尺寸合理性
*对于任意* 页面标题，其字号应在16-20px范围内；*对于任意* 正文内容，其字号应在11-13px范围内；*对于任意* 按钮文字，其字号应在12-13px范围内
**Validates: Requirements 9.4, 10.5**

### Property 9: 按钮尺寸合理性
*对于任意* 主要操作按钮，其宽度应在60-100px范围内，高度应为32px；*对于任意* 按钮，其水平内边距应至少为8px以确保文字不被截断
**Validates: Requirements 10.5**

### Property 10: 组件不溢出约束
*对于任意* 页面布局，所有组件应在其父容器边界内完整显示，不出现被遮挡或显示不全的情况
**Validates: Requirements 1.5, 2.7**

### Property 11: 动画时长合理性
*对于任意* UI动画效果，其时长应在100-300ms范围内，确保动画自然流畅且不影响用户操作
**Validates: 动画设计规范**

### Property 12: 页面切换响应性
*对于任意* 页面切换操作，从用户点击到页面显示的时间应不超过100ms
**Validates: 性能指标目标**

## 错误处理

### 布局错误处理

| 错误类型 | 处理策略 | 用户提示 |
|---------|---------|---------|
| 组件尺寸超出容器 | 自动调整或显示滚动条 | 无 |
| 布局常量未定义 | 使用默认值 | 无 |
| 样式表解析失败 | 使用系统默认样式 | 控制台警告 |
| 图标资源缺失 | 显示文字替代 | 无 |

## 测试策略

### 单元测试

- 测试布局常量类的值是否正确
- 测试卡片组件的样式属性
- 测试导航栏的宽度和项目间距
- 测试按钮样式的颜色值

### 属性测试

使用Hypothesis库进行属性测试：
- 布局间距一致性测试
- 页面布局比例测试
- 卡片样式一致性测试
- 按钮样式一致性测试

### 集成测试

- 测试各页面的整体布局结构
- 测试导航切换后页面布局的正确性
- 测试窗口尺寸固定为800x600

### 测试框架

- **单元测试**: pytest
- **属性测试**: hypothesis
- **GUI测试**: pytest-qt

