# 实现计划: YOLO 异步检测 (YOLO Async Detection)

## 概述

实现 YOLO 异步检测功能，将目标检测从主循环中分离到独立线程，提高整体帧率。

## 任务列表

- [ ] 1. 实现线程安全组件
  - [ ] 1.1 创建 `核心/异步检测.py` 文件，实现 `检测队列` 类
    - 线程安全的队列操作
    - 溢出计数跟踪
    - _需求: 1.2, 4.2_
  - [ ] 1.2 实现 `结果缓存` 类
    - 线程安全的结果存储
    - 时间戳记录
    - _需求: 2.1, 2.2, 2.3, 2.4, 4.1_
  - [ ]* 1.3 编写属性测试：线程安全性
    - **属性 1: 线程安全性**
    - *对于任意* 并发访问结果缓存的操作，不应产生数据竞争
    - **验证: 需求 4.1, 4.2**

- [ ] 2. 实现异步检测器
  - [ ] 2.1 实现 `异步检测器` 类核心功能
    - 检测线程管理
    - 帧提交和结果获取
    - _需求: 1.1, 1.3, 1.4_
  - [ ] 2.2 实现优雅关闭机制
    - 线程停止信号
    - 资源清理
    - _需求: 1.5_
  - [ ]* 2.3 编写属性测试：优雅关闭
    - **属性 2: 优雅关闭**
    - *对于任意* 停止请求，检测线程应在 1 秒内完成关闭
    - **验证: 需求 1.5**

- [ ] 3. 实现检测频率控制
  - [ ] 3.1 实现检测间隔配置
    - 支持帧数间隔
    - 支持毫秒间隔
    - _需求: 3.1_
  - [ ] 3.2 实现帧跳过逻辑
    - 队列满时跳过帧
    - 动态频率调整
    - _需求: 3.2, 3.4_

- [ ] 4. 实现性能监控
  - [ ] 4.1 实现 `性能监控器` 类
    - 延迟记录和统计
    - 队列状态跟踪
    - _需求: 5.1, 5.2, 5.3_
  - [ ] 4.2 实现警告机制
    - 检测落后警告
    - 日志记录
    - _需求: 3.3, 5.4_
  - [ ]* 4.3 编写属性测试：结果时效性
    - **属性 3: 结果时效性**
    - *对于任意* 获取的检测结果，时间戳应反映实际检测完成时间
    - **验证: 需求 2.3**

- [ ] 5. 实现异常处理
  - [ ] 5.1 实现检测线程异常处理
    - 捕获并记录异常
    - 继续运行不崩溃
    - _需求: 4.3, 4.4_
  - [ ] 5.2 实现回退机制
    - 线程启动失败时回退到同步检测
    - _需求: 4.4_

- [ ] 6. 集成到目标检测器
  - [ ] 6.1 修改 `核心/目标检测器.py`，集成异步检测器
    - 替换同步检测调用
    - 添加异步模式配置
    - _需求: 1.1, 1.4_
  - [ ] 6.2 添加异步检测配置
    - 队列大小、检测间隔等
    - _需求: 3.1_

- [ ] 7. 检查点 - 确保所有测试通过
  - 运行所有单元测试和属性测试
  - 验证帧率提升效果
  - 如有问题请询问用户

## 备注

- 带 `*` 标记的任务为可选测试任务
- 使用 threading 模块实现多线程
- 默认队列大小 3，检测间隔 3 帧
