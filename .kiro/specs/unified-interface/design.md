# 设计文档

## 概述

本设计文档描述如何将独立的配置界面整合到主界面中，实现统一的分页式界面。主要涉及三个文件的修改：`启动GUI.py`、`界面/主程序.py` 和 `界面/配置界面.py`。

## 架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                        启动GUI.py                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  检查依赖 → 直接启动主界面 (移除启动菜单)                    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      MainWindow (主程序.py)                      │
│  ┌──────────┬────────────────────────────────────────────────┐ │
│  │          │                                                │ │
│  │  导航栏   │              页面堆栈                          │ │
│  │  100px   │              700x600                           │ │
│  │          │  ┌──────────────────────────────────────────┐ │ │
│  │ ┌──────┐ │  │ 首页 │ 数据收集 │ 训练 │ 运行 │ 配置 │ 数据管理 │ │ │
│  │ │ 首页 │ │  └──────────────────────────────────────────┘ │ │
│  │ │数据收集│ │                                                │ │
│  │ │ 训练 │ │  配置页面 (嵌入完整配置界面)                      │ │
│  │ │ 运行 │ │  ┌──────────────────────────────────────────┐ │ │
│  │ │ 配置 │ │  │ 配置界面Widget (从QDialog改为QWidget)      │ │ │
│  │ │数据管理│ │  │ - 分区标签页 (窗口/模型/训练/运行)         │ │ │
│  │ └──────┘ │  │ - 档案管理                                │ │ │
│  │          │  │ - 实时验证                                │ │ │
│  │          │  │ - 窗口预览                                │ │ │
│  │          │  └──────────────────────────────────────────┘ │ │
│  └──────────┴────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 组件修改

### 1. 启动GUI.py 修改

移除启动菜单，直接启动主界面。

```python
# 修改前
def 主程序():
    # 显示启动菜单
    选项 = 显示启动菜单()
    if 选项 == "1":
        # 启动主界面
    elif 选项 == "2":
        # 启动配置界面
    ...

# 修改后
def 主程序():
    # 检查依赖
    if not 检查依赖():
        return 1
    # 直接启动主界面
    from 界面.主程序 import 启动应用
    return 启动应用()
```

**删除的函数:**
- `显示启动菜单()` - 不再需要
- `启动配置界面()` - 配置界面已整合到主界面

**保留的函数:**
- `检查依赖()` - 仍需检查PySide6等依赖

### 2. 配置界面.py 修改

将 `配置界面` 类从 `QDialog` 改为 `QWidget`，使其可嵌入主界面。

```python
# 修改前
class 配置界面(QDialog):
    def __init__(self, 配置管理器=None, parent=None):
        super().__init__(parent)
        # 对话框特性...

# 修改后
class 配置界面(QWidget):
    def __init__(self, 配置管理器=None, parent=None, 嵌入模式=False):
        super().__init__(parent)
        self._嵌入模式 = 嵌入模式
        # 根据模式调整界面...
```

**主要修改:**
1. 基类从 `QDialog` 改为 `QWidget`
2. 添加 `嵌入模式` 参数控制界面行为
3. 嵌入模式下:
   - 移除窗口标题设置
   - 移除取消按钮
   - 调整尺寸策略适配父容器
   - 移除 `closeEvent` 中的对话框特性
4. 保留独立运行能力（用于测试）

### 3. 主程序.py 修改

修改配置页面注册逻辑，使用完整配置界面替代简化配置页。

```python
# 修改前
def _注册配置页(self) -> None:
    self._配置页 = self._页面管理器.获取页面("配置")
    # 使用简化的配置页...

# 修改后
def _注册配置页(self) -> None:
    from 界面.配置界面 import 配置界面
    self._配置页 = 配置界面(嵌入模式=True)
    # 使用完整配置界面...
```

**主要修改:**
1. 修改 `_注册配置页()` 方法，使用 `配置界面` 替代 `配置页`
2. 修改 `_打开配置界面()` 方法，改为切换到配置页面
3. 更新页面管理器注册逻辑

### 4. 标题栏配置按钮修改

修改标题栏配置按钮行为，从打开对话框改为切换页面。

```python
# 修改前 (自定义标题栏.py)
def _点击配置按钮(self):
    self.配置请求.emit()  # 触发打开配置对话框

# 主程序.py
def _打开配置界面(self):
    配置对话框 = 配置界面(parent=self)
    配置对话框.exec()

# 修改后
def _打开配置界面(self):
    self.切换页面("配置")  # 直接切换到配置页面
```

## 数据流

```
用户操作                    系统响应
────────                    ────────
启动程序          →         检查依赖 → 显示主界面
点击导航栏"配置"   →         切换到配置页面
点击标题栏配置按钮  →         切换到配置页面
修改配置参数       →         实时验证 → 更新预览
点击保存按钮       →         验证 → 保存配置 → 发送信号
```

## 正确性属性

### 测试 1: 启动直接进入主界面
- **输入**: 运行 `python 启动GUI.py`
- **预期**: 直接显示主界面，无启动菜单
- **验证**: 检查窗口标题为 "🎮 MMORPG游戏AI助手"

### 测试 2: 配置页面显示完整功能
- **输入**: 点击导航栏"配置"项
- **预期**: 显示完整配置界面，包含4个标签页
- **验证**: 检查存在"窗口设置"、"模型设置"、"训练设置"、"运行设置"标签页

### 测试 3: 标题栏配置按钮跳转
- **输入**: 点击标题栏配置按钮
- **预期**: 切换到配置页面，导航栏高亮"配置"项
- **验证**: 检查当前页面为"配置"

### 测试 4: 配置保存功能
- **输入**: 修改配置参数，点击保存
- **预期**: 配置保存成功，状态栏显示"配置已保存"
- **验证**: 检查配置文件已更新

### 测试 5: 配置界面尺寸适配
- **输入**: 切换到配置页面
- **预期**: 配置界面适配700x600内容区域
- **验证**: 检查无水平滚动条，内容完整显示

### 测试 6: 窗口预览功能
- **输入**: 修改窗口区域参数
- **预期**: 预览区域实时更新
- **验证**: 检查预览显示与参数一致

### 测试 7: 档案管理功能
- **输入**: 创建/切换/删除档案
- **预期**: 档案操作正常，配置正确加载
- **验证**: 检查档案列表更新，配置值正确

## 文件变更清单

| 文件 | 变更类型 | 说明 |
|------|----------|------|
| `启动GUI.py` | 修改 | 移除启动菜单，直接启动主界面 |
| `界面/配置界面.py` | 修改 | 从QDialog改为QWidget，支持嵌入模式 |
| `界面/主程序.py` | 修改 | 使用完整配置界面替代简化配置页 |
| `界面/页面/配置页.py` | 保留 | 保留文件但不再使用（向后兼容） |

## 向后兼容性

1. `界面/配置界面.py` 保留独立运行能力，可通过 `python 界面/配置界面.py` 单独测试
2. `界面/页面/配置页.py` 保留但不再使用，避免破坏其他可能的引用
3. 配置文件格式不变，现有配置可正常加载
