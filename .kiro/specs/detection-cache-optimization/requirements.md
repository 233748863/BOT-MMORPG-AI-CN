# 需求文档

## 简介

检测结果缓存优化功能，实现智能缓存策略，根据画面变化程度决定是否重新执行检测，减少不必要的计算开销。

## 术语表

- **智能缓存**: 根据画面变化决定是否使用缓存结果的模块
- **帧比较器**: 计算两帧之间差异程度的模块
- **缓存策略**: 定义何时使用缓存、何时重新检测的规则

## 需求列表

### 需求 1: 画面变化检测

**用户故事:** 作为开发者，我希望检测画面变化程度，以便决定是否重用缓存结果。

#### 验收标准

1. 帧比较器应计算连续帧之间的相似度分数（0.0-1.0）
2. 帧比较器应使用高效算法（直方图比较或结构相似性）
3. 帧比较器应在 5ms 内完成比较
4. 帧比较器应支持可配置的比较区域（全帧或感兴趣区域）

### 需求 2: 智能缓存策略

**用户故事:** 作为开发者，我希望缓存能自动决定何时刷新，以便用最少的计算获得准确结果。

#### 验收标准

1. 当帧相似度高于阈值（默认：0.95）时，智能缓存应返回缓存结果
2. 当帧相似度低于阈值时，智能缓存应触发新的检测
3. 智能缓存应支持可配置的相似度阈值
4. 智能缓存应跟踪缓存命中率并报告统计信息

### 需求 3: 区域感知缓存

**用户故事:** 作为开发者，我希望缓存能考虑特定屏幕区域，以便不遗漏重要变化。

#### 验收标准

1. 智能缓存应支持定义优先区域（如战斗时的屏幕中心）
2. 当优先区域发生显著变化时，智能缓存应无视整体相似度使缓存失效
3. 智能缓存应支持为不同区域设置不同阈值
4. 缓存策略应可通过配置文件进行配置

### 需求 4: 缓存过期机制

**用户故事:** 作为开发者，我希望缓存结果在一定时间后过期，以便不使用过时数据。

#### 验收标准

1. 智能缓存应支持基于时间的过期（默认：500ms）
2. 当缓存过期时，智能缓存应在下次请求时触发新的检测
3. 智能缓存应支持在需要时禁用基于时间的过期
4. 智能缓存应记录缓存过期事件以便调试

### 需求 5: 缓存预热

**用户故事:** 作为开发者，我希望在启动时预填充缓存，以便前几帧有检测结果。

#### 验收标准

1. 当检测器启动时，智能缓存应执行初始检测以填充缓存
2. 智能缓存应指示何时处于"预热"状态
3. 预热时，智能缓存应返回空结果而非阻塞
