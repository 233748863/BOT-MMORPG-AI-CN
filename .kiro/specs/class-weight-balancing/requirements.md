# 需求文档

## 简介

类别权重平衡功能，解决训练数据中动作类别不平衡的问题（如"无操作"样本过多），通过类别权重或过采样策略提高模型对少数类别的学习效果。

## 术语表

- **类别平衡器**: 负责计算和应用类别权重的模块
- **样本权重**: 每个训练样本的重要性权重
- **过采样**: 复制少数类别样本以平衡数据集
- **欠采样**: 减少多数类别样本以平衡数据集

## 需求列表

### 需求 1: 类别分布分析

**用户故事:** 作为开发者，我希望分析训练数据中的类别分布，以便了解不平衡程度。

#### 验收标准

1. 类别平衡器应统计数据集中每个动作类别的样本数
2. 类别平衡器应计算不平衡比率（最大数量 / 最小数量）
3. 类别平衡器应将类别分布可视化为柱状图
4. 类别平衡器应识别严重欠代表的类别（少于最大值的 5%）
5. 类别平衡器应生成包含建议的报告

### 需求 2: 类别权重计算

**用户故事:** 作为开发者，我希望自动计算类别权重，以便模型更关注稀有动作。

#### 验收标准

1. 类别平衡器应为每个类别计算逆频率权重
2. 类别平衡器应支持不同的权重策略（逆频率、平方根逆频率、有效样本数）
3. 类别平衡器应归一化权重使平均权重为 1.0
4. 类别平衡器应将计算的权重保存到配置文件

### 需求 3: 训练集成

**用户故事:** 作为开发者，我希望在训练过程中应用类别权重，以便模型学习平衡的表示。

#### 验收标准

1. 训练脚本应接受类别权重作为参数
2. 当提供类别权重时，训练脚本应将其应用到损失函数
3. 类别平衡器应与现有训练流程集成
4. 训练脚本应在训练开始时记录应用的类别权重

### 需求 4: 过采样策略

**用户故事:** 作为开发者，我希望对稀有动作类别进行过采样，以便模型看到更多这些样本。

#### 验收标准

1. 类别平衡器应支持对少数类别进行随机过采样
2. 类别平衡器应支持类似 SMOTE 的少数类别增强
3. 类别平衡器应允许配置目标平衡比率
4. 类别平衡器应确保过采样数据被正确打乱

### 需求 5: 欠采样策略

**用户故事:** 作为开发者，我希望对多数类别进行欠采样，以便训练更快且更平衡。

#### 验收标准

1. 类别平衡器应支持对多数类别进行随机欠采样
2. 类别平衡器应支持知情欠采样（保留多样化样本）
3. 类别平衡器应允许配置每个类别的最大样本数
4. 类别平衡器应报告平衡后的最终数据集大小
