# 实现计划: 类别权重平衡 (Class Weight Balancing)

## 概述

实现类别权重平衡功能，解决训练数据中动作类别不平衡问题。

## 任务列表

- [x] 1. 实现类别分析器
  - [x] 1.1 扩展 `工具/类别权重.py` 文件，实现 `类别分析器` 类
    - 统计各类别样本数量
    - 计算不平衡比率
    - _需求: 1.1, 1.2_
  - [x] 1.2 实现欠代表类别识别
    - 识别少于最大值 5% 的类别
    - 生成分析报告
    - _需求: 1.4, 1.5_
  - [x] 1.3 实现可视化功能
    - 生成类别分布柱状图
    - _需求: 1.3_

- [x] 2. 实现权重计算器
  - [x] 2.1 实现 `权重计算器` 类
    - 逆频率权重计算
    - 平方根逆频率权重计算
    - 有效样本数权重计算
    - _需求: 2.1, 2.2_
  - [x] 2.2 实现权重归一化
    - 归一化使平均权重为 1.0
    - _需求: 2.3_
  - [x] 2.3 实现权重保存和加载
    - 保存到配置文件
    - _需求: 2.4_
  - [x] 2.4 编写属性测试：权重归一化

    - **属性 1: 权重归一化**
    - *对于任意* 类别权重集合，归一化后平均权重应等于 1.0
    - **验证: 需求 2.3**

- [x] 3. 实现采样器
  - [x] 3.1 实现 `采样器` 类
    - 随机过采样
    - 随机欠采样
    - _需求: 4.1, 5.1_
  - [x] 3.2 实现高级采样策略
    - 增强过采样（类似 SMOTE）
    - 知情欠采样（保留多样化样本）
    - _需求: 4.2, 5.2_
  - [x] 3.3 实现采样配置
    - 目标平衡比率配置
    - 最大样本数配置
    - 数据打乱
    - _需求: 4.3, 4.4, 5.3, 5.4_
  - [x] 3.4 编写属性测试：过采样平衡

    - **属性 2: 过采样平衡**
    - *对于任意* 过采样后的数据集，各类别样本数量差异应在目标比率范围内
    - **验证: 需求 4.3**

- [x] 4. 实现加权损失函数
  - [x] 4.1 实现 `加权交叉熵损失` 类
    - 接受类别权重参数
    - 应用到损失计算
    - _需求: 3.2_

- [x] 5. 集成到训练流程
  - [x] 5.1 修改 `训练/训练模型.py`，集成类别权重
    - 接受类别权重参数
    - 应用加权损失函数
    - 记录应用的权重
    - _需求: 3.1, 3.3, 3.4_
  - [x] 5.2 添加平衡配置到训练配置
    - 权重策略配置
    - 采样策略配置
    - _需求: 2.4_

- [x] 6. 创建分析脚本
  - [x] 6.1 创建 `工具/分析类别分布.py` 脚本
    - 命令行接口
    - 生成分析报告和可视化
    - _需求: 1.3, 1.5_

- [x] 7. 检查点 - 确保所有测试通过
  - 运行所有单元测试和属性测试
  - 如有问题请询问用户

## 备注

- 带 `*` 标记的任务为可选测试任务
- 使用 imbalanced-learn 库辅助实现采样
- 默认使用逆频率权重策略
