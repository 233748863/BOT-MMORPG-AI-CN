# -*- coding: utf-8 -*-
"""
布局常量单元测试模块

验证布局常量值在合理范围内，确保UI元素不会出现过大、过小或显示不全的问题。

**Validates: Requirements 1.2, 1.3, 1.4**
- 1.2: 内容区域使用16px的统一外边距
- 1.3: 卡片组件使用12px的统一内边距
- 1.4: 卡片组件之间保持12px的统一间距
"""

import sys
import os

# 添加项目根目录到路径
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

import pytest
from 界面.样式.布局常量 import (
    布局常量,
    页面布局配置,
    计算预览区域尺寸,
    验证字号范围,
    验证按钮尺寸,
    验证动画时长,
)


class Test布局常量基本值:
    """
    测试布局常量的基本值是否在合理范围内
    
    **Validates: Requirements 1.2, 1.3, 1.4**
    """
    
    def test_内容区外边距为16px(self):
        """
        验证内容区域外边距为16px
        
        **Validates: Requirements 1.2**
        """
        assert 布局常量.内容区外边距 == 16, \
            f"内容区外边距应为16px，实际为{布局常量.内容区外边距}px"
    
    def test_卡片内边距为12px(self):
        """
        验证卡片组件内边距为12px
        
        **Validates: Requirements 1.3**
        """
        assert 布局常量.卡片内边距 == 12, \
            f"卡片内边距应为12px，实际为{布局常量.卡片内边距}px"
    
    def test_卡片间距为12px(self):
        """
        验证卡片组件之间间距为12px
        
        **Validates: Requirements 1.4**
        """
        assert 布局常量.卡片间距 == 12, \
            f"卡片间距应为12px，实际为{布局常量.卡片间距}px"


class Test窗口尺寸常量:
    """测试窗口尺寸相关常量"""
    
    def test_窗口尺寸为800x600(self):
        """验证窗口尺寸为800x600"""
        assert 布局常量.窗口宽度 == 800, f"窗口宽度应为800，实际为{布局常量.窗口宽度}"
        assert 布局常量.窗口高度 == 600, f"窗口高度应为600，实际为{布局常量.窗口高度}"
    
    def test_内容区尺寸计算正确(self):
        """验证内容区尺寸计算正确"""
        # 内容区宽度 = 窗口宽度 - 导航栏宽度 - 外边距*2
        期望宽度 = 布局常量.窗口宽度 - 布局常量.导航栏宽度 - 布局常量.内容区外边距 * 2
        assert 布局常量.内容区宽度 == 期望宽度, \
            f"内容区宽度应为{期望宽度}，实际为{布局常量.内容区宽度}"
        
        # 内容区高度 = 窗口高度 - 状态栏高度 - 外边距*2
        期望高度 = 布局常量.窗口高度 - 布局常量.状态栏高度 - 布局常量.内容区外边距 * 2
        assert 布局常量.内容区高度 == 期望高度, \
            f"内容区高度应为{期望高度}，实际为{布局常量.内容区高度}"


class Test导航栏常量:
    """测试导航栏相关常量"""
    
    def test_导航栏宽度为100px(self):
        """验证导航栏宽度为100px"""
        assert 布局常量.导航栏宽度 == 100, \
            f"导航栏宽度应为100px，实际为{布局常量.导航栏宽度}px"
    
    def test_导航项高度合理(self):
        """验证导航项高度在合理范围内（30-50px）"""
        assert 30 <= 布局常量.导航项高度 <= 50, \
            f"导航项高度应在30-50px范围内，实际为{布局常量.导航项高度}px"
    
    def test_导航图标尺寸为24px(self):
        """验证导航图标尺寸为24x24像素"""
        assert 布局常量.导航图标尺寸 == 24, \
            f"导航图标尺寸应为24px，实际为{布局常量.导航图标尺寸}px"


class Test卡片组件常量:
    """测试卡片组件相关常量"""
    
    def test_卡片圆角为8px(self):
        """验证卡片圆角为8px"""
        assert 布局常量.卡片圆角 == 8, \
            f"卡片圆角应为8px，实际为{布局常量.卡片圆角}px"
    
    def test_卡片边框宽度为1px(self):
        """验证卡片边框宽度为1px"""
        assert 布局常量.卡片边框宽度 == 1, \
            f"卡片边框宽度应为1px，实际为{布局常量.卡片边框宽度}px"
    
    def test_卡片最小高度合理(self):
        """验证卡片最小高度在合理范围内（60-100px）"""
        assert 60 <= 布局常量.卡片最小高度 <= 100, \
            f"卡片最小高度应在60-100px范围内，实际为{布局常量.卡片最小高度}px"


class Test字号常量:
    """测试字号相关常量"""
    
    def test_页面标题字号在合理范围内(self):
        """验证页面标题字号在16-20px范围内"""
        assert 布局常量.页面标题字号最小 <= 布局常量.页面标题字号 <= 布局常量.页面标题字号最大, \
            f"页面标题字号应在{布局常量.页面标题字号最小}-{布局常量.页面标题字号最大}px范围内"
        assert 16 <= 布局常量.页面标题字号 <= 20, \
            f"页面标题字号应在16-20px范围内，实际为{布局常量.页面标题字号}px"
    
    def test_卡片标题字号在合理范围内(self):
        """验证卡片标题字号在12-14px范围内"""
        assert 布局常量.卡片标题字号最小 <= 布局常量.卡片标题字号 <= 布局常量.卡片标题字号最大, \
            f"卡片标题字号应在{布局常量.卡片标题字号最小}-{布局常量.卡片标题字号最大}px范围内"
        assert 12 <= 布局常量.卡片标题字号 <= 14, \
            f"卡片标题字号应在12-14px范围内，实际为{布局常量.卡片标题字号}px"
    
    def test_正文字号在合理范围内(self):
        """验证正文字号在11-13px范围内"""
        assert 布局常量.正文字号最小 <= 布局常量.正文字号 <= 布局常量.正文字号最大, \
            f"正文字号应在{布局常量.正文字号最小}-{布局常量.正文字号最大}px范围内"
        assert 11 <= 布局常量.正文字号 <= 13, \
            f"正文字号应在11-13px范围内，实际为{布局常量.正文字号}px"
    
    def test_按钮文字字号在合理范围内(self):
        """验证按钮文字字号在12-13px范围内"""
        assert 布局常量.按钮文字字号最小 <= 布局常量.按钮文字字号 <= 布局常量.按钮文字字号最大, \
            f"按钮文字字号应在{布局常量.按钮文字字号最小}-{布局常量.按钮文字字号最大}px范围内"
        assert 12 <= 布局常量.按钮文字字号 <= 13, \
            f"按钮文字字号应在12-13px范围内，实际为{布局常量.按钮文字字号}px"
    
    def test_最小文字字号不小于10px(self):
        """验证最小文字字号不小于10px，确保可读性"""
        assert 布局常量.最小文字字号 >= 10, \
            f"最小文字字号应不小于10px，实际为{布局常量.最小文字字号}px"


class Test按钮常量:
    """测试按钮相关常量"""
    
    def test_按钮高度为32px(self):
        """验证按钮高度为32px"""
        assert 布局常量.按钮高度 == 32, \
            f"按钮高度应为32px，实际为{布局常量.按钮高度}px"
    
    def test_按钮宽度范围合理(self):
        """验证按钮宽度范围在60-100px"""
        assert 布局常量.按钮最小宽度 == 60, \
            f"按钮最小宽度应为60px，实际为{布局常量.按钮最小宽度}px"
        assert 布局常量.按钮最大宽度 == 100, \
            f"按钮最大宽度应为100px，实际为{布局常量.按钮最大宽度}px"
    
    def test_按钮圆角为6px(self):
        """验证按钮圆角为6px"""
        assert 布局常量.按钮圆角 == 6, \
            f"按钮圆角应为6px，实际为{布局常量.按钮圆角}px"
    
    def test_按钮水平内边距至少8px(self):
        """验证按钮水平内边距至少8px，确保文字不被截断"""
        assert 布局常量.按钮水平内边距 >= 8, \
            f"按钮水平内边距应至少8px，实际为{布局常量.按钮水平内边距}px"
    
    def test_快捷按钮尺寸范围合理(self):
        """验证快捷按钮尺寸在120-140px宽，80-90px高"""
        assert 布局常量.快捷按钮宽度最小 == 120, \
            f"快捷按钮最小宽度应为120px，实际为{布局常量.快捷按钮宽度最小}px"
        assert 布局常量.快捷按钮宽度最大 == 140, \
            f"快捷按钮最大宽度应为140px，实际为{布局常量.快捷按钮宽度最大}px"
        assert 布局常量.快捷按钮高度最小 == 80, \
            f"快捷按钮最小高度应为80px，实际为{布局常量.快捷按钮高度最小}px"
        assert 布局常量.快捷按钮高度最大 == 90, \
            f"快捷按钮最大高度应为90px，实际为{布局常量.快捷按钮高度最大}px"


class Test预览区域常量:
    """测试预览区域相关常量"""
    
    def test_预览区域宽高比为16比9(self):
        """验证预览区域宽高比为16:9"""
        期望比例 = 16 / 9
        assert abs(布局常量.预览区域宽高比 - 期望比例) < 0.001, \
            f"预览区域宽高比应为16:9（约{期望比例:.4f}），实际为{布局常量.预览区域宽高比}"
    
    def test_预览区域尺寸范围合理(self):
        """验证预览区域尺寸在200-280px宽，112-158px高"""
        assert 布局常量.预览区域宽度最小 == 200, \
            f"预览区域最小宽度应为200px，实际为{布局常量.预览区域宽度最小}px"
        assert 布局常量.预览区域宽度最大 == 280, \
            f"预览区域最大宽度应为280px，实际为{布局常量.预览区域宽度最大}px"
        assert 布局常量.预览区域高度最小 == 112, \
            f"预览区域最小高度应为112px，实际为{布局常量.预览区域高度最小}px"
        assert 布局常量.预览区域高度最大 == 158, \
            f"预览区域最大高度应为158px，实际为{布局常量.预览区域高度最大}px"


class Test动画常量:
    """测试动画相关常量"""
    
    def test_动画时长在100到300ms范围内(self):
        """验证动画时长在100-300ms范围内"""
        assert 布局常量.动画时长最小 == 100, \
            f"动画最小时长应为100ms，实际为{布局常量.动画时长最小}ms"
        assert 布局常量.动画时长最大 == 300, \
            f"动画最大时长应为300ms，实际为{布局常量.动画时长最大}ms"
    
    def test_标准动画时长在合理范围内(self):
        """验证标准动画时长在100-300ms范围内"""
        assert 布局常量.动画时长最小 <= 布局常量.动画时长快速 <= 布局常量.动画时长最大, \
            f"快速动画时长应在{布局常量.动画时长最小}-{布局常量.动画时长最大}ms范围内"
        assert 布局常量.动画时长最小 <= 布局常量.动画时长标准 <= 布局常量.动画时长最大, \
            f"标准动画时长应在{布局常量.动画时长最小}-{布局常量.动画时长最大}ms范围内"
        assert 布局常量.动画时长最小 <= 布局常量.动画时长慢速 <= 布局常量.动画时长最大, \
            f"慢速动画时长应在{布局常量.动画时长最小}-{布局常量.动画时长最大}ms范围内"


class Test布局比例常量:
    """测试布局比例相关常量"""
    
    def test_数据收集页布局比例为60比40(self):
        """验证数据收集页左右栏比例为60:40"""
        assert 布局常量.数据收集页左栏比例 == 60, \
            f"数据收集页左栏比例应为60，实际为{布局常量.数据收集页左栏比例}"
        assert 布局常量.数据收集页右栏比例 == 40, \
            f"数据收集页右栏比例应为40，实际为{布局常量.数据收集页右栏比例}"
        assert 布局常量.数据收集页左栏比例 + 布局常量.数据收集页右栏比例 == 100, \
            "数据收集页左右栏比例之和应为100"
    
    def test_运行页布局比例为50比50(self):
        """验证运行页左右栏比例为50:50"""
        assert 布局常量.运行页左栏比例 == 50, \
            f"运行页左栏比例应为50，实际为{布局常量.运行页左栏比例}"
        assert 布局常量.运行页右栏比例 == 50, \
            f"运行页右栏比例应为50，实际为{布局常量.运行页右栏比例}"
        assert 布局常量.运行页左栏比例 + 布局常量.运行页右栏比例 == 100, \
            "运行页左右栏比例之和应为100"
    
    def test_数据管理页布局比例为65比35(self):
        """验证数据管理页左右栏比例为65:35"""
        assert 布局常量.数据管理页左栏比例 == 65, \
            f"数据管理页左栏比例应为65，实际为{布局常量.数据管理页左栏比例}"
        assert 布局常量.数据管理页右栏比例 == 35, \
            f"数据管理页右栏比例应为35，实际为{布局常量.数据管理页右栏比例}"
        assert 布局常量.数据管理页左栏比例 + 布局常量.数据管理页右栏比例 == 100, \
            "数据管理页左右栏比例之和应为100"
    
    def test_训练页布局比例为60比40(self):
        """验证训练页上下区比例为60:40"""
        assert 布局常量.训练页上区比例 == 60, \
            f"训练页上区比例应为60，实际为{布局常量.训练页上区比例}"
        assert 布局常量.训练页下区比例 == 40, \
            f"训练页下区比例应为40，实际为{布局常量.训练页下区比例}"
        assert 布局常量.训练页上区比例 + 布局常量.训练页下区比例 == 100, \
            "训练页上下区比例之和应为100"


class Test边距保护常量:
    """测试边距保护相关常量"""
    
    def test_最小边距至少8px(self):
        """验证最小边距至少8px"""
        assert 布局常量.最小边距 >= 8, \
            f"最小边距应至少8px，实际为{布局常量.最小边距}px"
    
    def test_文字边框间距至少4px(self):
        """验证文字与边框间距至少4px"""
        assert 布局常量.文字边框间距 >= 4, \
            f"文字边框间距应至少4px，实际为{布局常量.文字边框间距}px"


class Test辅助函数:
    """测试辅助函数"""
    
    def test_计算预览区域尺寸_正常宽度(self):
        """测试计算预览区域尺寸函数 - 正常宽度"""
        宽度, 高度 = 计算预览区域尺寸(250)
        assert 宽度 == 250, f"宽度应为250，实际为{宽度}"
        assert 高度 == int(250 / (16/9)), f"高度应保持16:9比例"
    
    def test_计算预览区域尺寸_小于最小宽度(self):
        """测试计算预览区域尺寸函数 - 小于最小宽度"""
        宽度, 高度 = 计算预览区域尺寸(100)
        assert 宽度 == 布局常量.预览区域宽度最小, \
            f"宽度应为最小值{布局常量.预览区域宽度最小}，实际为{宽度}"
    
    def test_计算预览区域尺寸_大于最大宽度(self):
        """测试计算预览区域尺寸函数 - 大于最大宽度"""
        宽度, 高度 = 计算预览区域尺寸(500)
        assert 宽度 == 布局常量.预览区域宽度最大, \
            f"宽度应为最大值{布局常量.预览区域宽度最大}，实际为{宽度}"
    
    def test_验证字号范围_页面标题(self):
        """测试验证字号范围函数 - 页面标题"""
        assert 验证字号范围(18, "页面标题") is True
        assert 验证字号范围(15, "页面标题") is False
        assert 验证字号范围(21, "页面标题") is False
    
    def test_验证字号范围_正文(self):
        """测试验证字号范围函数 - 正文"""
        assert 验证字号范围(12, "正文") is True
        assert 验证字号范围(10, "正文") is False
        assert 验证字号范围(14, "正文") is False
    
    def test_验证按钮尺寸_主要按钮(self):
        """测试验证按钮尺寸函数 - 主要按钮"""
        assert 验证按钮尺寸(80, 32, "主要") is True
        assert 验证按钮尺寸(50, 32, "主要") is False  # 宽度太小
        assert 验证按钮尺寸(80, 28, "主要") is False  # 高度不对
    
    def test_验证按钮尺寸_快捷按钮(self):
        """测试验证按钮尺寸函数 - 快捷按钮"""
        assert 验证按钮尺寸(130, 85, "快捷") is True
        assert 验证按钮尺寸(100, 85, "快捷") is False  # 宽度太小
        assert 验证按钮尺寸(130, 70, "快捷") is False  # 高度太小
    
    def test_验证动画时长(self):
        """测试验证动画时长函数"""
        assert 验证动画时长(200) is True
        assert 验证动画时长(100) is True
        assert 验证动画时长(300) is True
        assert 验证动画时长(50) is False
        assert 验证动画时长(400) is False


class Test页面布局配置:
    """测试页面布局配置"""
    
    def test_数据收集页配置正确(self):
        """验证数据收集页配置"""
        配置 = 页面布局配置.数据收集页
        assert 配置["布局类型"] == "左右两栏"
        assert 配置["左栏比例"] == 60
        assert 配置["右栏比例"] == 40
    
    def test_训练页配置正确(self):
        """验证训练页配置"""
        配置 = 页面布局配置.训练页
        assert 配置["布局类型"] == "上下两区"
        assert 配置["上区比例"] == 60
        assert 配置["下区比例"] == 40
    
    def test_运行页配置正确(self):
        """验证运行页配置"""
        配置 = 页面布局配置.运行页
        assert 配置["布局类型"] == "左右两栏"
        assert 配置["左栏比例"] == 50
        assert 配置["右栏比例"] == 50
    
    def test_数据管理页配置正确(self):
        """验证数据管理页配置"""
        配置 = 页面布局配置.数据管理页
        assert 配置["布局类型"] == "左右两栏"
        assert 配置["左栏比例"] == 65
        assert 配置["右栏比例"] == 35


if __name__ == "__main__":
    pytest.main([__file__, "-v", "--tb=short"])
